# 실습: S3 수명 주기 정책을 활용한 스토리지 비용 최적화

## 개요
이 실습에서는 Amazon S3 수명 주기 정책을 구성하여 스토리지 비용을 최적화하는 방법을 학습합니다. 다양한 액세스 패턴을 가진 데이터를 시뮬레이션하고, 적절한 스토리지 클래스로 자동 전환하거나 만료시키는 정책을 구현합니다.

**소요 시간:** 60분
**난이도:** 초급

## 학습 목표
이 실습을 완료하면 다음을 수행할 수 있게 됩니다:
- S3 스토리지 클래스의 특성과 비용 차이를 이해하기
- 데이터 액세스 패턴에 따른 최적의 스토리지 클래스 선택하기
- S3 수명 주기 정책을 설계하고 구성하기
- 접두사 및 태그 기반 수명 주기 규칙 적용하기
- S3 스토리지 비용 분석 및 최적화 효과 계산하기

## 사전 요구사항
이 실습을 시작하기 전에 다음이 필요합니다:
- AWS 계정 액세스 (관리자 권한 또는 S3 관련 권한)
- 업로드할 샘플 파일 (텍스트 파일, 이미지 등)
- AWS Management Console 기본 사용법 이해

## 아키텍처 개요

### 구현할 아키텍처
이 실습에서는 다음과 같은 S3 수명 주기 관리 아키텍처를 구현합니다:

```
+----------------------------------+
|                                  |
|        S3 버킷                   |
|                                  |
+----------------------------------+
        |            |            |
        v            v            v
+-------------+ +-------------+ +-------------+
|             | |             | |             |
| 자주 액세스  | | 가끔 액세스  | | 아카이브    |
| (Standard)  | | (Standard-IA)| | (Glacier)  |
|             | |             | |             |
+-------------+ +-------------+ +-------------+
        |            |            |
        v            v            v
+----------------------------------+
|                                  |
|      수명 주기 정책               |
|                                  |
+----------------------------------+
        |            |            |
        v            v            v
+-------------+ +-------------+ +-------------+
|             | |             | |             |
| 30일 후     | | 90일 후     | | 365일 후    |
| Standard-IA | | Glacier     | | 만료(삭제)  |
|             | |             | |             |
+-------------+ +-------------+ +-------------+
```

### 구성 요소
- **S3 버킷**: 다양한 액세스 패턴을 가진 객체를 저장하는 버킷
- **S3 스토리지 클래스**: Standard, Standard-IA, Glacier 등 다양한 스토리지 클래스
- **S3 수명 주기 정책**: 객체의 수명 주기를 관리하는 규칙 집합
- **접두사(폴더)**: 객체를 논리적으로 구성하는 방법
- **객체 태그**: 객체에 메타데이터를 추가하여 분류하는 방법

### 작동 방식
1. 다양한 액세스 패턴을 가진 객체를 S3 버킷에 업로드합니다.
2. 접두사와 태그를 사용하여 객체를 구성합니다.
3. 수명 주기 정책을 구성하여 객체를 자동으로 다른 스토리지 클래스로 전환하거나 만료시킵니다.
4. 시간이 지남에 따라 객체는 비용 효율적인 스토리지 클래스로 자동 이동됩니다.
5. 더 이상 필요하지 않은 객체는 자동으로 삭제됩니다.

## 실습 단계

### 1단계: S3 버킷 생성
**목적:** 수명 주기 정책을 적용할 S3 버킷을 생성합니다.

1. AWS Management Console에 로그인합니다.

2. 상단 검색창에 "S3"를 입력하고 서비스를 선택합니다.
   ![S3 콘솔 액세스](images/s3-console-access.png)

3. "버킷 만들기" 버튼을 클릭합니다.
   ![버킷 만들기](images/s3-create-bucket.png)

4. 다음 설정으로 버킷을 구성합니다:
   - 버킷 이름: `lifecycle-demo-[YOUR-INITIALS]-[YYYYMMDD]` (고유한 이름 사용)
   - AWS 리전: 가장 가까운 리전 선택
   - 객체 소유권: ACL 비활성화됨(권장)
   - 퍼블릭 액세스 차단 설정: 모든 퍼블릭 액세스 차단 (기본값 유지)
   - 버킷 버전 관리: 활성화
   - 태그: 키 = `Purpose`, 값 = `Lifecycle-Demo`
   
5. "버킷 만들기" 버튼을 클릭합니다.
   ![버킷 설정](images/s3-bucket-settings.png)

**확인 포인트:** 버킷 목록에 새 버킷이 표시되는지 확인합니다.

### 2단계: 폴더 구조 생성 및 객체 업로드
**목적:** 다양한 액세스 패턴을 시뮬레이션하기 위한 폴더 구조를 생성하고 객체를 업로드합니다.

1. 생성한 버킷을 클릭하여 버킷 세부 정보 페이지로 이동합니다.

2. "폴더 만들기" 버튼을 클릭하고 다음 폴더를 생성합니다:
   - `frequent-access/` (자주 액세스하는 데이터용)
   - `infrequent-access/` (가끔 액세스하는 데이터용)
   - `archive/` (장기 보존 데이터용)
   ![폴더 만들기](images/s3-create-folders.png)

3. `frequent-access/` 폴더를 클릭하고 "업로드" 버튼을 클릭합니다.

4. "파일 추가" 버튼을 클릭하고 로컬 컴퓨터에서 몇 개의 파일을 선택합니다.

5. "추가 설정"을 확장하고 다음 설정을 구성합니다:
   - 스토리지 클래스: Standard
   - 태그 추가: 키 = `AccessPattern`, 값 = `Frequent`
   
6. "업로드" 버튼을 클릭합니다.
   ![객체 업로드](images/s3-upload-objects.png)

7. 이전 단계를 반복하여 `infrequent-access/` 폴더에 파일을 업로드하되, 태그를 `AccessPattern` = `Infrequent`로 설정합니다.

8. 마찬가지로 `archive/` 폴더에 파일을 업로드하되, 태그를 `AccessPattern` = `Archive`로 설정합니다.

**확인 포인트:** 각 폴더에 파일이 업로드되고 적절한 태그가 적용되었는지 확인합니다.

### 3단계: 접두사 기반 수명 주기 정책 구성
**목적:** 폴더(접두사) 기반으로 객체의 수명 주기를 관리하는 정책을 구성합니다.

1. 버킷 세부 정보 페이지에서 "관리" 탭을 클릭합니다.

2. "수명 주기 규칙 생성" 버튼을 클릭합니다.
   ![수명 주기 규칙 생성](images/s3-create-lifecycle-rule.png)

3. 수명 주기 규칙을 구성합니다:
   - 수명 주기 규칙 이름: `InfrequentAccessRule`
   - 규칙 범위: 특정 접두사에 적용
   - 접두사: `infrequent-access/`
   - 태그 필터: 추가하지 않음
   ![규칙 범위 설정](images/s3-rule-scope.png)

4. "수명 주기 규칙 작업" 섹션에서 다음 작업을 선택합니다:
   - "현재 버전의 스토리지 클래스 전환" 체크
   - "다음으로 전환" 드롭다운에서 "Standard-IA"를 선택하고 일수를 "30"으로 설정
   - "다음으로 전환" 드롭다운에서 "Glacier Flexible Retrieval"을 선택하고 일수를 "90"으로 설정
   - "현재 버전 만료" 체크하고 일수를 "365"로 설정
   ![스토리지 클래스 전환](images/s3-transition-actions.png)

5. "이전 버전에 대한 작업" 섹션에서 다음 작업을 선택합니다:
   - "이전 버전의 스토리지 클래스 전환" 체크
   - "다음으로 전환" 드롭다운에서 "Glacier Flexible Retrieval"을 선택하고 일수를 "30"으로 설정
   - "이전 버전 영구 삭제" 체크하고 일수를 "90"으로 설정
   ![이전 버전 작업](images/s3-previous-versions.png)

6. "만료되지 않은 삭제 마커 또는 불완전한 멀티파트 업로드 삭제" 섹션에서 다음 작업을 선택합니다:
   - "만료된 삭제 마커 삭제" 체크
   - "불완전한 멀티파트 업로드 삭제" 체크하고 일수를 "7"로 설정
   ![삭제 마커 및 멀티파트 업로드](images/s3-delete-markers.png)

7. "생성" 버튼을 클릭합니다.

**확인 포인트:** 수명 주기 규칙 목록에 `InfrequentAccessRule`이 표시되는지 확인합니다.

### 4단계: 태그 기반 수명 주기 정책 구성
**목적:** 객체 태그를 기반으로 수명 주기를 관리하는 정책을 구성합니다.

1. "수명 주기 규칙 생성" 버튼을 다시 클릭합니다.

2. 수명 주기 규칙을 구성합니다:
   - 수명 주기 규칙 이름: `ArchiveRule`
   - 규칙 범위: 특정 태그가 있는 객체에 적용
   - 태그 필터: 키 = `AccessPattern`, 값 = `Archive`
   ![태그 기반 규칙](images/s3-tag-based-rule.png)

3. "수명 주기 규칙 작업" 섹션에서 다음 작업을 선택합니다:
   - "현재 버전의 스토리지 클래스 전환" 체크
   - "다음으로 전환" 드롭다운에서 "Glacier Flexible Retrieval"을 선택하고 일수를 "30"으로 설정
   - "다음으로 전환" 드롭다운에서 "Glacier Deep Archive"를 선택하고 일수를 "180"으로 설정
   ![아카이브 전환](images/s3-archive-transitions.png)

4. "생성" 버튼을 클릭합니다.

**확인 포인트:** 수명 주기 규칙 목록에 `ArchiveRule`이 표시되는지 확인합니다.

### 5단계: 버킷 전체 수명 주기 정책 구성
**목적:** 버킷 전체에 적용되는 기본 수명 주기 정책을 구성합니다.

1. "수명 주기 규칙 생성" 버튼을 다시 클릭합니다.

2. 수명 주기 규칙을 구성합니다:
   - 수명 주기 규칙 이름: `DefaultRule`
   - 규칙 범위: 버킷의 모든 객체에 적용
   ![버킷 전체 규칙](images/s3-bucket-wide-rule.png)

3. "수명 주기 규칙 작업" 섹션에서 다음 작업을 선택합니다:
   - "불완전한 멀티파트 업로드 삭제" 체크하고 일수를 "7"로 설정
   - "만료된 삭제 마커 삭제" 체크
   ![기본 작업](images/s3-default-actions.png)

4. "생성" 버튼을 클릭합니다.

**확인 포인트:** 수명 주기 규칙 목록에 `DefaultRule`이 표시되는지 확인합니다.

### 6단계: 수명 주기 규칙 검증 및 모니터링
**목적:** 구성한 수명 주기 규칙이 올바르게 작동하는지 확인하고 모니터링합니다.

1. 버킷 세부 정보 페이지에서 "관리" 탭을 클릭하고 "수명 주기 규칙" 섹션을 확인합니다.
   ![수명 주기 규칙 목록](images/s3-lifecycle-rules-list.png)

2. 각 규칙을 클릭하여 세부 정보를 확인합니다.

3. 객체 목록으로 돌아가서 객체를 선택하고 "작업" 드롭다운 메뉴에서 "스토리지 클래스 편집"을 클릭합니다.
   ![스토리지 클래스 확인](images/s3-check-storage-class.png)

   > **참고:** 실제 스토리지 클래스 전환은 수명 주기 규칙에 설정한 일수가 지난 후에 발생합니다. 이 단계에서는 현재 스토리지 클래스를 확인하고 수동으로 변경할 수 있는 방법을 보여줍니다.

4. S3 인벤토리 구성을 설정하여 객체의 스토리지 클래스 변화를 주기적으로 모니터링합니다:
   - "관리" 탭에서 "인벤토리 구성" 섹션으로 이동합니다.
   - "인벤토리 구성 생성" 버튼을 클릭합니다.
   - 인벤토리 이름: `LifecycleInventory`
   - 대상 버킷: 동일한 버킷 또는 다른 버킷 선택
   - 빈도: 매주
   - 출력 형식: CSV
   - 객체 메타데이터: 스토리지 클래스, 크기, 마지막 수정 날짜 등 선택
   - "생성" 버튼 클릭
   ![인벤토리 구성](images/s3-inventory-config.png)

**확인 포인트:** 수명 주기 규칙이 올바르게 구성되었고, 인벤토리 보고서가 설정되었는지 확인합니다.

### 7단계: S3 스토리지 비용 분석
**목적:** S3 스토리지 비용을 분석하고 수명 주기 정책의 비용 절감 효과를 예측합니다.

1. AWS Management Console에서 "Cost Explorer"로 이동합니다.

2. "Cost Explorer 시작" 버튼을 클릭합니다.

3. 필터를 설정하여 S3 관련 비용만 표시합니다:
   - "필터" 섹션에서 "서비스" 필터 추가
   - "Amazon Simple Storage Service"를 선택합니다.
   ![S3 비용 필터](images/cost-explorer-s3-filter.png)

4. 그룹화 옵션을 "사용 유형"으로 설정하여 스토리지 클래스별 비용을 확인합니다.
   ![스토리지 클래스별 비용](images/cost-explorer-storage-class.png)

5. 수명 주기 정책 구현 전후의 예상 비용 절감액을 계산합니다:
   - 현재 Standard 스토리지 비용 확인
   - Standard-IA 및 Glacier로 전환 시 예상 비용 계산
   - 불필요한 객체 삭제로 인한 비용 절감 계산
   ![비용 절감 계산](images/cost-savings-calculation.png)

   > **참고:** 실제 비용 절감 효과는 시간이 지남에 따라 수명 주기 정책이 적용된 후에 확인할 수 있습니다.

**확인 포인트:** S3 스토리지 비용 분석이 완료되고 예상 비용 절감액이 계산되었는지 확인합니다.

## 결과 검증
실습이 성공적으로 완료되었는지 확인하려면:

1. S3 버킷에 세 개의 폴더(`frequent-access/`, `infrequent-access/`, `archive/`)가 생성되고 각 폴더에 파일이 업로드되었는지 확인합니다.
   - 예상 결과: 각 폴더에 업로드한 파일 확인 가능

2. 세 개의 수명 주기 규칙(`InfrequentAccessRule`, `ArchiveRule`, `DefaultRule`)이 생성되었는지 확인합니다.
   - 예상 결과: "관리" 탭의 수명 주기 규칙 목록에서 세 개의 규칙 확인 가능

3. 각 수명 주기 규칙의 설정이 올바르게 구성되었는지 확인합니다.
   - 예상 결과: 각 규칙의 세부 정보에서 스토리지 클래스 전환 및 만료 설정 확인 가능

4. S3 인벤토리 구성이 설정되었는지 확인합니다.
   - 예상 결과: "관리" 탭의 인벤토리 구성 목록에서 `LifecycleInventory` 확인 가능

5. Cost Explorer에서 S3 스토리지 비용 분석이 가능한지 확인합니다.
   - 예상 결과: Cost Explorer에서 S3 관련 비용 데이터 확인 가능

## 리소스 정리
불필요한 비용이 발생하지 않도록 다음 리소스를 삭제하세요:

1. S3 버킷 삭제:
   - S3 콘솔로 이동합니다.
   - 생성한 버킷을 선택합니다.
   - "삭제" 버튼을 클릭합니다.
   - 확인 대화 상자에 버킷 이름을 입력하고 "삭제" 버튼을 클릭합니다.
   ![버킷 삭제](images/s3-delete-bucket.png)

   > **중요:** 버킷을 삭제하면 버킷 내의 모든 객체와 구성(수명 주기 규칙, 인벤토리 구성 등)이 함께 삭제됩니다.

## 도전 과제 (선택 사항)
1. **버전 관리된 객체 수명 주기 관리:** 버전 관리가 활성화된 버킷에서 이전 버전의 객체에 대한 수명 주기 정책을 구성하고 테스트하세요.
   - 힌트: 동일한 키로 여러 버전의 객체를 업로드하고, 이전 버전에 대한 수명 주기 규칙을 구성하세요.

2. **S3 Analytics 활용:** S3 Analytics를 구성하여 Standard 스토리지 클래스에서 Standard-IA로 전환할 수 있는 객체를 식별하세요.
   - 힌트: "관리" 탭에서 "Analytics" 섹션을 확인하세요.

3. **S3 Intelligent-Tiering 테스트:** 액세스 패턴이 변하는 데이터에 대해 S3 Intelligent-Tiering 스토리지 클래스를 적용하고 비용 효과를 분석하세요.
   - 힌트: 객체를 업로드할 때 스토리지 클래스로 "Intelligent-Tiering"을 선택하세요.

## 추가 학습 자료
- [Amazon S3 스토리지 클래스](https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-class-intro.html)
- [S3 수명 주기 관리](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html)
- [S3 비용 최적화 모범 사례](https://docs.aws.amazon.com/AmazonS3/latest/userguide/cost-optimization.html)
- [S3 인벤토리](https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-inventory.html)
- [S3 Analytics - 스토리지 클래스 분석](https://docs.aws.amazon.com/AmazonS3/latest/userguide/analytics-storage-class.html)
- [AWS Well-Architected Framework - 비용 최적화 원칙 (스토리지 섹션)](https://docs.aws.amazon.com/wellarchitected/latest/cost-optimization-pillar/cost-effective-storage.html)