# Day 2-5: IAM 모범 사례 종합

## 📚 학습 목표
- 부서별 권한 그룹 설계 전략 수립
- 임시 계정 및 외부 사용자 관리 방법 이해
- 정기적 권한 검토 프로세스 구축
- IAM 전체 내용 정리 및 이해도 점검

---

## 🏢 부서별 권한 그룹 설계 (45분)

### 실제 회사 조직도 기반 설계

#### 시나리오: IT 스타트업 "CloudTech"
```
조직 구조:
├── 경영진 (C-Level)
├── 개발팀 (Development)
│   ├── 백엔드 개발자
│   ├── 프론트엔드 개발자
│   └── DevOps 엔지니어
├── 운영팀 (Operations)
│   ├── 시스템 관리자
│   └── 보안 관리자
├── 데이터팀 (Data Analytics)
│   ├── 데이터 분석가
│   └── 데이터 엔지니어
└── 인턴/임시직
```

### 실습 1: 경영진 그룹 설계

#### 권한 요구사항 분석
```
경영진 필요 권한:
- 전체 비용 현황 조회
- 서비스 사용량 모니터링
- 보안 상태 확인
- 중요 설정 변경 승인

제한 사항:
- 직접적인 리소스 조작 불가
- 개발 환경 접근 불필요
- 기술적 세부사항 숨김
```

#### 그룹 생성 및 정책 설정
```
1단계: 그룹 생성
- Group name: Executives
- Description: 경영진 대시보드 접근

2단계: 정책 연결
AWS 관리형 정책:
☑ Billing (결제 정보 조회)
☑ CloudWatchReadOnlyAccess (모니터링)
☑ AWSConfigUserAccess (규정 준수)

커스텀 정책: Executive-Dashboard-Access
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ce:GetCostAndUsage",
        "ce:GetUsageReport",
        "support:DescribeCases",
        "trustedadvisor:Describe*"
      ],
      "Resource": "*"
    }
  ]
}
```

### 실습 2: 개발팀 그룹 설계

#### 환경별 권한 분리
```
개발 환경 (Development):
- 모든 서비스 완전 접근
- 리소스 생성/수정/삭제 가능
- 비용 제한 설정

스테이징 환경 (Staging):
- 제한적 접근
- 배포 및 테스트만 가능
- 프로덕션 유사 환경

프로덕션 환경 (Production):
- 읽기 전용 접근
- 긴급 상황 시에만 쓰기 권한
- 승인 프로세스 필요
```

#### 개발자 그룹 생성
```
1단계: 환경별 그룹 생성
- Developers-Dev: 개발 환경 완전 접근
- Developers-Staging: 스테이징 환경 제한 접근
- Developers-Prod-ReadOnly: 프로덕션 읽기 전용

2단계: 태그 기반 권한 정책
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "*",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/Environment": "Development"
        }
      }
    },
    {
      "Effect": "Deny",
      "Action": [
        "iam:*",
        "organizations:*",
        "account:*"
      ],
      "Resource": "*"
    }
  ]
}
```

### 실습 3: 데이터팀 그룹 설계

#### 데이터 분석가 권한
```
필요 서비스:
- S3: 데이터 레이크 접근
- Athena: 쿼리 실행
- QuickSight: 대시보드 생성
- Glue: 데이터 카탈로그 조회

제한 사항:
- 원본 데이터 수정 불가
- 인프라 리소스 생성 불가
- 비용 발생 서비스 제한
```

#### 정책 설계
```
커스텀 정책: DataAnalyst-Access
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::company-datalake",
        "arn:aws:s3:::company-datalake/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "athena:*",
        "glue:GetDatabase",
        "glue:GetTable",
        "quicksight:*"
      ],
      "Resource": "*"
    }
  ]
}
```

---

## 👥 임시 계정 관리 전략 (30분)

### 인턴 및 임시직 관리

#### 임시 계정 특징
```
보안 요구사항:
- 제한된 권한
- 명확한 만료일
- 정기적 검토
- 즉시 비활성화 가능

관리 복잡성:
- 빈번한 계정 생성/삭제
- 권한 변경 요청
- 프로젝트별 접근 권한
```

#### 실습: 인턴 그룹 설계
```
1단계: 인턴 그룹 생성
- Group name: Interns
- Description: 인턴 및 임시직 제한 접근

2단계: 기본 권한 설정
AWS 관리형 정책:
☑ ReadOnlyAccess (기본 조회 권한)

추가 제한 정책:
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Deny",
      "Action": [
        "iam:*",
        "billing:*",
        "support:*"
      ],
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "ec2:DescribeInstances",
        "s3:ListBucket",
        "s3:GetObject"
      ],
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/AccessLevel": "Intern"
        }
      }
    }
  ]
}
```

### 외부 컨설턴트 접근 관리

#### 교차 계정 역할 활용
```
시나리오:
- 외부 보안 컨설팅 업체
- 일시적 보안 감사 필요
- 자체 AWS 계정 보유

해결책:
- 교차 계정 IAM 역할 생성
- 시간 제한 접근
- 특정 작업만 허용
```

#### 실습: 외부 컨설턴트 역할
```
1단계: 역할 생성
- Role name: SecurityAuditor-External
- Trusted entity: 컨설팅 업체 AWS 계정

2단계: 신뢰 정책
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::CONSULTANT-ACCOUNT:root"
      },
      "Action": "sts:AssumeRole",
      "Condition": {
        "StringEquals": {
          "sts:ExternalId": "SecurityAudit-2024-Q1"
        },
        "DateLessThan": {
          "aws:CurrentTime": "2024-03-31T23:59:59Z"
        }
      }
    }
  ]
}

3단계: 권한 정책
- SecurityAudit 관련 읽기 권한만 부여
- 중요 설정 변경 권한 제외
```

---

## 📋 정기적 권한 검토 프로세스 (30분)

### 권한 검토 주기 설정

#### 검토 주기별 활동
```
주간 검토:
- 새로 생성된 사용자 확인
- 권한 변경 요청 처리
- 보안 알림 확인

월간 검토:
- 사용자별 권한 사용 현황
- 미사용 권한 식별
- 액세스 키 로테이션 상태

분기별 검토:
- 전체 권한 구조 재평가
- 조직 변경사항 반영
- 보안 정책 업데이트

연간 검토:
- 전체 IAM 전략 재검토
- 규정 준수 감사
- 보안 아키텍처 개선
```

### 실습: 권한 검토 자동화

#### CloudWatch를 활용한 모니터링
```
1단계: 미사용 사용자 탐지
Lambda 함수로 구현:
- Credential Report 분석
- 90일 이상 미사용 사용자 식별
- 관리자에게 알림 발송

2단계: 권한 사용 패턴 분석
CloudTrail 로그 분석:
- 사용자별 API 호출 패턴
- 부여된 권한 vs 실제 사용 권한
- 과도한 권한 식별

3단계: 자동 알림 설정
SNS 토픽 생성:
- 권한 검토 알림
- 보안 이벤트 알림
- 정기 보고서 발송
```

#### 권한 검토 체크리스트
```
사용자 계정 검토:
☑ 활성 사용자 목록 확인
☑ 퇴사자 계정 비활성화
☑ 임시 계정 만료일 확인
☑ MFA 설정 현황

권한 검토:
☑ 과도한 권한 부여 확인
☑ 미사용 권한 식별
☑ 그룹 멤버십 적절성
☑ 정책 변경 이력

보안 검토:
☑ 액세스 키 로테이션 상태
☑ 비밀번호 정책 준수
☑ 보안 알림 설정
☑ CloudTrail 로깅 상태
```

---

## 🔄 IAM 거버넌스 프레임워크 (30분)

### 권한 요청 및 승인 프로세스

#### 표준 프로세스 설계
```
1단계: 권한 요청
- 요청자: 필요한 권한과 사유 명시
- 관리자: 비즈니스 필요성 검토
- 보안팀: 보안 위험 평가

2단계: 권한 승인
- 최소 권한 원칙 적용
- 임시 권한 vs 영구 권한 결정
- 검토 주기 설정

3단계: 권한 부여
- 적절한 그룹 할당
- 커스텀 정책 생성 (필요시)
- 사용자 교육 및 안내

4단계: 모니터링
- 권한 사용 현황 추적
- 정기적 재검토
- 필요시 권한 조정
```

### 실습: 권한 요청 템플릿 작성

#### 권한 요청서 양식
```
권한 요청서

요청자 정보:
- 이름: [이름]
- 부서: [부서명]
- 직급: [직급]
- 이메일: [이메일]

권한 정보:
- 요청 권한: [구체적인 AWS 서비스 및 작업]
- 필요 사유: [비즈니스 필요성 설명]
- 사용 기간: [임시/영구, 만료일]
- 접근 리소스: [특정 리소스 ARN]

승인자:
- 직속 상관: [서명/날짜]
- IT 관리자: [서명/날짜]
- 보안 담당자: [서명/날짜]

검토 일정:
- 다음 검토일: [날짜]
- 검토 주기: [주간/월간/분기]
```

---

## 📊 IAM 성숙도 평가 (15분)

### 보안 성숙도 체크리스트

#### Level 1: 기본 (Basic)
```
☑ 루트 계정 MFA 설정
☑ 개별 IAM 사용자 생성
☑ 기본 그룹 구성
☑ AWS 관리형 정책 사용
☑ CloudTrail 기본 로깅
```

#### Level 2: 중급 (Intermediate)
```
☑ 커스텀 정책 작성
☑ 조건부 접근 정책
☑ 정기적 권한 검토
☑ 액세스 키 로테이션
☑ 보안 모니터링 알림
```

#### Level 3: 고급 (Advanced)
```
☑ 교차 계정 역할 관리
☑ 자동화된 권한 검토
☑ 세밀한 리소스 기반 정책
☑ 규정 준수 자동 모니터링
☑ 제로 트러스트 아키텍처
```

---

## 📝 Day 2 종합 정리 (30분)

### IAM 핵심 개념 복습

#### 4대 구성 요소
```
1. 사용자 (User):
   - 개별 개체의 신원
   - 영구적 자격 증명
   - 사람 또는 애플리케이션

2. 그룹 (Group):
   - 사용자들의 집합
   - 권한 관리 효율화
   - 역할 기반 구성

3. 역할 (Role):
   - 임시 권한 위임
   - 교차 계정 접근
   - 서비스 간 권한 부여

4. 정책 (Policy):
   - 권한 규칙 정의
   - JSON 형식 문서
   - 세밀한 권한 제어
```

### 보안 모범 사례 요약

#### 핵심 원칙
```
1. 최소 권한 원칙:
   - 필요한 최소한의 권한만 부여
   - 정기적 권한 검토 및 정리

2. 심층 방어:
   - MFA 다중 인증 적용
   - 조건부 접근 정책 활용

3. 지속적 모니터링:
   - CloudTrail 로깅
   - 보안 이벤트 알림

4. 자동화:
   - 권한 검토 자동화
   - 보안 정책 자동 적용
```

---

## 🧠 이해도 점검 퀴즈 (15문항)

### 1. IAM 사용자와 역할의 주요 차이점은?
```
a) 사용자는 임시, 역할은 영구적
b) 사용자는 영구적, 역할은 임시적
c) 둘 다 동일한 기능
d) 역할은 사용자보다 권한이 많음

정답: b) 사용자는 영구적, 역할은 임시적
```

### 2. MFA의 주요 보안 효과는?
```
a) 비밀번호를 더 복잡하게 만듦
b) 계정 탈취 위험을 99.9% 감소
c) 로그인 속도를 향상시킴
d) 비용을 절약함

정답: b) 계정 탈취 위험을 99.9% 감소
```

### 3. 최소 권한 원칙의 올바른 적용 방법은?
```
a) 처음부터 모든 권한 부여 후 제거
b) 필요한 최소 권한부터 시작하여 점진적 확대
c) 관리자 권한을 모든 사용자에게 부여
d) 권한 부여 후 검토하지 않음

정답: b) 필요한 최소 권한부터 시작하여 점진적 확대
```

---

## 📚 내일 학습 예고

### IAM 고급 & 다중 계정 전략
```
학습 내용:
- IAM 역할(Role) 심화 학습
- 교차 계정 액세스 실습
- AWS STS(Security Token Service) 활용
- AWS Organizations 다중 계정 관리
- 서비스 제어 정책(SCP) 적용

준비사항:
- 오늘 생성한 IAM 사용자들 정리
- MFA 설정 완료 확인
- 액세스 키 안전 보관 확인
```

---

> 💡 **Day 2 핵심**: IAM은 AWS 보안의 기초입니다. 사용자, 그룹, 역할, 정책을 올바르게 설계하고 관리하는 것이 안전한 클라우드 환경의 첫걸음입니다. MFA와 정기적 권한 검토를 통해 지속적으로 보안을 강화해야 합니다!