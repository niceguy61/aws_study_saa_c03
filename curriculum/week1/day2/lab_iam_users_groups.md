# 실습: IAM 사용자 및 그룹 관리

## 개요
이 실습에서는 AWS Identity and Access Management(IAM)를 사용하여 사용자와 그룹을 생성하고 관리하는 방법을 학습합니다. IAM을 통해 AWS 리소스에 대한 액세스를 안전하게 제어하고, 최소 권한 원칙을 적용하여 보안을 강화하는 방법을 실습합니다.

## 학습 목표
- IAM 사용자 생성 및 관리 방법 습득
- IAM 그룹 생성 및 관리 방법 습득
- IAM 정책 연결 및 권한 테스트 방법 이해
- IAM 암호 정책 구성 방법 학습
- IAM 보안 모범 사례 적용 방법 습득

## 사전 준비 사항
- AWS 계정 액세스
- AWS Management Console 로그인 정보
- 관리자 권한 (AdministratorAccess 또는 IAM 관련 권한)
- 웹 브라우저 (Chrome, Firefox, Safari, Edge 최신 버전 권장)

## 실습 단계

### 1. IAM 대시보드 살펴보기

#### 1.1 IAM 대시보드 접근
1. AWS Management Console에 로그인합니다.
2. 서비스 메뉴에서 "IAM"을 검색하거나 선택합니다.
3. IAM 대시보드가 표시됩니다.

#### 1.2 IAM 보안 상태 확인
IAM 대시보드에서 "보안 권장 사항"을 확인합니다:
1. 루트 사용자 MFA 활성화 상태
2. 개별 IAM 사용자 생성 상태
3. 그룹을 사용하여 권한 관리 상태
4. 최소 권한 적용 상태
5. 자격 증명 보고서 생성 및 검토 상태

#### 1.3 계정 정보 확인
IAM 대시보드에서 다음 정보를 확인합니다:
1. AWS 계정 ID
2. 계정 별칭 (설정된 경우)
3. IAM 사용자 로그인 링크

### 2. IAM 사용자 생성

#### 2.1 관리자 사용자 생성
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자"를 클릭합니다.
2. "사용자 추가" 버튼을 클릭합니다.
3. 사용자 세부 정보 설정:
   - 사용자 이름: `admin-user`
   - AWS Management Console 액세스 선택
   - 콘솔 암호 옵션 선택 (자동 생성 또는 사용자 지정)
   - 암호 재설정 요구 옵션 선택
4. "다음: 권한" 버튼을 클릭합니다.
5. "기존 정책 직접 연결" 옵션을 선택합니다.
6. 검색 상자에 "AdministratorAccess"를 입력하고 해당 정책을 선택합니다.
7. "다음: 태그" 버튼을 클릭합니다.
8. (선택 사항) 태그 추가:
   - 키: `Department`, 값: `IT`
   - 키: `Role`, 값: `Administrator`
9. "다음: 검토" 버튼을 클릭합니다.
10. 설정을 검토하고 "사용자 생성" 버튼을 클릭합니다.
11. 성공 메시지가 표시되면 "자격 증명 다운로드" 버튼을 클릭하여 로그인 정보를 저장합니다.

#### 2.2 일반 사용자 생성
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자"를 클릭합니다.
2. "사용자 추가" 버튼을 클릭합니다.
3. 사용자 세부 정보 설정:
   - 사용자 이름: `regular-user`
   - AWS Management Console 액세스 선택
   - 콘솔 암호 옵션 선택 (자동 생성 또는 사용자 지정)
   - 암호 재설정 요구 옵션 선택
4. "다음: 권한" 버튼을 클릭합니다.
5. 이 단계에서는 권한을 추가하지 않고 "다음: 태그" 버튼을 클릭합니다.
6. (선택 사항) 태그 추가:
   - 키: `Department`, 값: `Operations`
   - 키: `Role`, 값: `User`
7. "다음: 검토" 버튼을 클릭합니다.
8. 설정을 검토하고 "사용자 생성" 버튼을 클릭합니다.
9. 성공 메시지가 표시되면 "자격 증명 다운로드" 버튼을 클릭하여 로그인 정보를 저장합니다.

#### 2.3 프로그래밍 방식 액세스 사용자 생성
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자"를 클릭합니다.
2. "사용자 추가" 버튼을 클릭합니다.
3. 사용자 세부 정보 설정:
   - 사용자 이름: `api-user`
   - 프로그래밍 방식 액세스 선택
4. "다음: 권한" 버튼을 클릭합니다.
5. "기존 정책 직접 연결" 옵션을 선택합니다.
6. 검색 상자에 "ReadOnlyAccess"를 입력하고 해당 정책을 선택합니다.
7. "다음: 태그" 버튼을 클릭합니다.
8. (선택 사항) 태그 추가:
   - 키: `Department`, 값: `Development`
   - 키: `Role`, 값: `API`
9. "다음: 검토" 버튼을 클릭합니다.
10. 설정을 검토하고 "사용자 생성" 버튼을 클릭합니다.
11. 성공 메시지가 표시되면 "자격 증명 다운로드" 버튼을 클릭하여 액세스 키 ID와 비밀 액세스 키를 저장합니다.
    - **중요**: 이 화면을 닫은 후에는 비밀 액세스 키를 다시 볼 수 없으므로 반드시 안전한 곳에 저장하세요.

### 3. IAM 그룹 생성 및 관리

#### 3.1 관리자 그룹 생성
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자 그룹"을 클릭합니다.
2. "그룹 생성" 버튼을 클릭합니다.
3. 그룹 이름 입력: `Administrators`
4. 정책 연결:
   - 검색 상자에 "AdministratorAccess"를 입력하고 해당 정책을 선택합니다.
5. "그룹 생성" 버튼을 클릭합니다.

#### 3.2 개발자 그룹 생성
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자 그룹"을 클릭합니다.
2. "그룹 생성" 버튼을 클릭합니다.
3. 그룹 이름 입력: `Developers`
4. 정책 연결:
   - 검색 상자에 "PowerUserAccess"를 입력하고 해당 정책을 선택합니다.
   - 이 정책은 관리 기능을 제외한 대부분의 AWS 서비스 및 리소스에 대한 액세스를 제공합니다.
5. "그룹 생성" 버튼을 클릭합니다.

#### 3.3 읽기 전용 그룹 생성
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자 그룹"을 클릭합니다.
2. "그룹 생성" 버튼을 클릭합니다.
3. 그룹 이름 입력: `ReadOnly`
4. 정책 연결:
   - 검색 상자에 "ReadOnlyAccess"를 입력하고 해당 정책을 선택합니다.
   - 이 정책은 모든 AWS 리소스에 대한 읽기 전용 액세스를 제공합니다.
5. "그룹 생성" 버튼을 클릭합니다.

#### 3.4 사용자를 그룹에 추가
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자 그룹"을 클릭합니다.
2. "Administrators" 그룹을 클릭합니다.
3. "사용자" 탭에서 "사용자 추가" 버튼을 클릭합니다.
4. `admin-user`를 선택하고 "사용자 추가" 버튼을 클릭합니다.
5. "사용자 그룹" 목록으로 돌아가서 "ReadOnly" 그룹을 클릭합니다.
6. "사용자" 탭에서 "사용자 추가" 버튼을 클릭합니다.
7. `regular-user`를 선택하고 "사용자 추가" 버튼을 클릭합니다.
8. "사용자 그룹" 목록으로 돌아가서 "Developers" 그룹을 클릭합니다.
9. "사용자" 탭에서 "사용자 추가" 버튼을 클릭합니다.
10. `api-user`를 선택하고 "사용자 추가" 버튼을 클릭합니다.

### 4. IAM 정책 살펴보기 및 사용자 지정 정책 생성

#### 4.1 AWS 관리형 정책 살펴보기
1. IAM 대시보드에서 왼쪽 탐색 창의 "정책"을 클릭합니다.
2. 기본적으로 AWS 관리형 정책이 표시됩니다.
3. 검색 상자를 사용하여 다음 정책을 찾아보고 내용을 확인합니다:
   - AdministratorAccess
   - PowerUserAccess
   - ReadOnlyAccess
   - AmazonS3ReadOnlyAccess
   - AmazonEC2FullAccess
4. 정책을 선택하고 "정책 세부 정보" 페이지에서 JSON 탭을 클릭하여 정책 문서를 확인합니다.

#### 4.2 사용자 지정 정책 생성 (시각적 편집기 사용)
1. IAM 대시보드에서 왼쪽 탐색 창의 "정책"을 클릭합니다.
2. "정책 생성" 버튼을 클릭합니다.
3. "시각적 편집기" 탭에서 다음을 구성합니다:
   - 서비스 선택: "S3"
   - 작업 선택:
     - "읽기" 섹션에서 "GetObject", "ListBucket" 선택
     - "쓰기" 섹션에서 "PutObject" 선택
   - 리소스 선택:
     - "특정" 선택
     - "버킷 추가" 클릭하고 "이 계정의 모든 버킷" 선택
     - "객체 추가" 클릭하고 "이 계정의 모든 객체" 선택
   - 요청 조건 (선택 사항):
     - "조건 추가" 클릭
     - 조건 키: "aws:PrincipalTag/Department"
     - 연산자: "StringEquals"
     - 값: "Development"
4. "다음: 태그" 버튼을 클릭합니다.
5. (선택 사항) 태그 추가:
   - 키: `Purpose`, 값: `S3Access`
6. "다음: 검토" 버튼을 클릭합니다.
7. 정책 이름 입력: `CustomS3DeveloperAccess`
8. 설명 입력: `Allow developers to read and write objects in S3 buckets`
9. "정책 생성" 버튼을 클릭합니다.

#### 4.3 사용자 지정 정책 생성 (JSON 편집기 사용)
1. IAM 대시보드에서 왼쪽 탐색 창의 "정책"을 클릭합니다.
2. "정책 생성" 버튼을 클릭합니다.
3. "JSON" 탭을 클릭하고 다음 정책 문서를 입력합니다:

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:Describe*",
        "ec2:Get*",
        "ec2:List*"
      ],
      "Resource": "*"
    },
    {
      "Effect": "Allow",
      "Action": [
        "cloudwatch:GetMetricData",
        "cloudwatch:GetMetricStatistics",
        "cloudwatch:ListMetrics"
      ],
      "Resource": "*"
    }
  ]
}
```

4. "다음: 태그" 버튼을 클릭합니다.
5. (선택 사항) 태그 추가:
   - 키: `Purpose`, 값: `EC2Monitoring`
6. "다음: 검토" 버튼을 클릭합니다.
7. 정책 이름 입력: `EC2MonitoringAccess`
8. 설명 입력: `Allow users to view EC2 instances and CloudWatch metrics`
9. "정책 생성" 버튼을 클릭합니다.

### 5. 사용자 지정 정책 연결 및 테스트

#### 5.1 사용자 지정 정책 연결
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자 그룹"을 클릭합니다.
2. "Developers" 그룹을 클릭합니다.
3. "권한" 탭에서 "권한 추가" 드롭다운을 클릭하고 "정책 연결"을 선택합니다.
4. 검색 상자에 "CustomS3DeveloperAccess"를 입력하고 해당 정책을 선택합니다.
5. "권한 추가" 버튼을 클릭합니다.
6. "ReadOnly" 그룹으로 돌아가서 "권한 추가" 드롭다운을 클릭하고 "정책 연결"을 선택합니다.
7. 검색 상자에 "EC2MonitoringAccess"를 입력하고 해당 정책을 선택합니다.
8. "권한 추가" 버튼을 클릭합니다.

#### 5.2 정책 시뮬레이터 사용
1. IAM 대시보드에서 왼쪽 탐색 창의 "액세스 관리" 아래 "액세스 분석기"를 클릭합니다.
2. "정책 검증" 탭을 클릭합니다.
3. "정책 소스" 드롭다운에서 "사용자"를 선택합니다.
4. `regular-user`를 선택합니다.
5. "서비스" 드롭다운에서 "Amazon EC2"를 선택합니다.
6. "작업" 목록에서 다음 작업을 선택합니다:
   - DescribeInstances
   - RunInstances
   - TerminateInstances
7. "정책 검증 실행" 버튼을 클릭합니다.
8. 결과를 확인합니다:
   - DescribeInstances: 허용됨 (EC2MonitoringAccess 정책에 의해)
   - RunInstances: 거부됨 (명시적 허용 없음)
   - TerminateInstances: 거부됨 (명시적 허용 없음)

### 6. IAM 암호 정책 구성

#### 6.1 계정 암호 정책 확인
1. IAM 대시보드에서 왼쪽 탐색 창의 "계정 설정"을 클릭합니다.
2. "암호 정책" 탭을 확인합니다.
3. 현재 암호 정책 설정을 검토합니다.

#### 6.2 암호 정책 강화
1. "암호 정책" 탭에서 "편집" 버튼을 클릭합니다.
2. 다음 설정을 구성합니다:
   - 최소 암호 길이: 12
   - 대문자 필요: 활성화
   - 소문자 필요: 활성화
   - 숫자 필요: 활성화
   - 영숫자 외 문자 필요: 활성화
   - 암호 만료 활성화: 활성화
   - 암호 만료 기간(일): 90
   - 암호 만료 전 사용자가 암호를 변경하도록 허용: 활성화
   - 암호 재사용 방지: 활성화
   - 기억할 이전 암호 수: 5
3. "변경 사항 저장" 버튼을 클릭합니다.

### 7. IAM 보안 모범 사례 적용

#### 7.1 MFA 활성화
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자"를 클릭합니다.
2. `admin-user`를 선택합니다.
3. "보안 자격 증명" 탭을 클릭합니다.
4. "할당된 MFA 디바이스" 섹션에서 "MFA 디바이스 할당" 버튼을 클릭합니다.
5. MFA 디바이스 유형 선택:
   - "가상 MFA 디바이스" 선택
   - "계속" 버튼 클릭
6. "QR 코드 표시" 섹션에서:
   - 스마트폰에 Google Authenticator, Authy 또는 기타 MFA 앱 설치
   - 앱에서 QR 코드를 스캔하거나 제공된 비밀 키를 수동으로 입력
7. 앱에서 생성된 두 개의 연속 MFA 코드를 입력합니다.
8. "MFA 할당" 버튼을 클릭합니다.

#### 7.2 액세스 키 관리
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자"를 클릭합니다.
2. `api-user`를 선택합니다.
3. "보안 자격 증명" 탭을 클릭합니다.
4. "액세스 키" 섹션에서 기존 액세스 키의 상태를 확인합니다.
5. 액세스 키 교체 시뮬레이션:
   - "액세스 키 생성" 버튼을 클릭합니다.
   - 경고를 읽고 "액세스 키 생성" 버튼을 클릭합니다.
   - 새 액세스 키 ID와 비밀 액세스 키를 안전한 곳에 저장합니다.
   - 이전 액세스 키를 선택하고 "작업" 드롭다운에서 "비활성화"를 선택합니다.
   - 새 액세스 키로 애플리케이션을 업데이트한 후, 이전 액세스 키를 선택하고 "작업" 드롭다운에서 "삭제"를 선택합니다.
   - 경고를 읽고 "삭제" 버튼을 클릭합니다.

#### 7.3 IAM 자격 증명 보고서 생성
1. IAM 대시보드에서 왼쪽 탐색 창의 "자격 증명 보고서"를 클릭합니다.
2. "보고서 다운로드" 버튼을 클릭합니다.
3. 보고서가 생성되면 "다운로드" 버튼을 클릭하여 CSV 파일로 저장합니다.
4. 스프레드시트 프로그램(Excel, Google Sheets 등)에서 보고서를 열고 다음 정보를 검토합니다:
   - 사용자 생성 날짜
   - 암호 활성화 상태
   - 암호 마지막 사용 날짜
   - MFA 활성화 상태
   - 액세스 키 상태 및 마지막 사용 날짜

### 8. 정리 (선택 사항)

실습이 완료되면 생성한 리소스를 정리할 수 있습니다. 실제 환경에서는 필요한 리소스만 유지하는 것이 좋습니다.

#### 8.1 사용자 삭제
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자"를 클릭합니다.
2. 삭제할 사용자를 선택합니다.
3. "삭제" 버튼을 클릭합니다.
4. 사용자 이름을 입력하여 삭제를 확인합니다.
5. "삭제" 버튼을 클릭합니다.

#### 8.2 그룹 삭제
1. IAM 대시보드에서 왼쪽 탐색 창의 "사용자 그룹"을 클릭합니다.
2. 삭제할 그룹을 선택합니다.
3. "삭제" 버튼을 클릭합니다.
4. "삭제" 버튼을 클릭하여 확인합니다.

#### 8.3 사용자 지정 정책 삭제
1. IAM 대시보드에서 왼쪽 탐색 창의 "정책"을 클릭합니다.
2. "고객 관리형" 필터를 선택합니다.
3. 삭제할 정책을 선택합니다.
4. "작업" 드롭다운을 클릭하고 "삭제"를 선택합니다.
5. 정책 이름을 입력하여 삭제를 확인합니다.
6. "삭제" 버튼을 클릭합니다.

## 실습 결과물
이 실습을 완료하면 다음과 같은 결과물을 얻게 됩니다:
1. 다양한 권한을 가진 IAM 사용자
2. 역할 기반 IAM 그룹
3. 사용자 지정 IAM 정책
4. 강화된 암호 정책
5. MFA로 보호된 사용자 계정
6. IAM 자격 증명 보고서

## 문제 해결 가이드

### 권한 오류
- **증상**: "액세스 거부" 오류 메시지
- **해결 방법**:
  - 사용자에게 필요한 권한이 있는지 확인
  - 정책 시뮬레이터를 사용하여 권한 테스트
  - 명시적 거부 정책이 있는지 확인
  - 리소스 기반 정책 확인 (해당하는 경우)

### MFA 설정 문제
- **증상**: MFA 코드가 인식되지 않음
- **해결 방법**:
  - 디바이스 시간이 정확한지 확인
  - QR 코드를 다시 스캔하거나 비밀 키를 수동으로 입력
  - 다른 MFA 앱 시도

### 암호 정책 적용 문제
- **증상**: 새 암호 정책이 기존 사용자에게 적용되지 않음
- **해결 방법**:
  - 암호 정책은 새 암호 또는 암호 변경 시에만 적용됨
  - 사용자에게 암호 변경 요청

### 액세스 키 문제
- **증상**: 액세스 키로 API 호출 실패
- **해결 방법**:
  - 액세스 키가 활성 상태인지 확인
  - 올바른 액세스 키 ID와 비밀 액세스 키를 사용하는지 확인
  - 사용자에게 필요한 권한이 있는지 확인

## 추가 학습 자료
- [IAM 사용 설명서](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html)
- [IAM 모범 사례](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)
- [IAM 정책 참조](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies.html)
- [AWS 보안 블로그 - IAM 관련 게시물](https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-identity-and-access-management-iam/)

## 다음 단계
이 실습을 완료한 후에는 다음 주제를 학습할 준비가 되었습니다:
1. IAM 역할 및 임시 자격 증명
2. 다중 계정 관리 전략
3. ID 페더레이션 및 AWS SSO
4. IAM 권한 경계 및 서비스 제어 정책(SCP)