# IAM 개요 및 기본 개념

## 개요
AWS Identity and Access Management(IAM)는 AWS 리소스에 대한 액세스를 안전하게 제어하는 웹 서비스입니다. IAM을 사용하면 사용자, 그룹, 역할을 생성하고 관리하며, AWS 리소스에 대한 권한을 세밀하게 제어할 수 있습니다. 이 강의에서는 IAM의 기본 개념, 핵심 구성 요소, 작동 방식 및 보안 모범 사례에 대해 알아봅니다.

## 학습 목표
- IAM의 정의와 목적 이해
- IAM의 핵심 구성 요소(사용자, 그룹, 역할, 정책) 파악
- IAM 작동 방식 및 권한 평가 로직 이해
- IAM 보안 모범 사례 학습
- IAM을 효과적으로 사용하여 AWS 환경의 보안을 강화하는 방법 습득

## IAM의 정의 및 목적

### IAM이란?
IAM(Identity and Access Management)은 AWS 서비스와 리소스에 대한 액세스를 안전하게 제어하는 서비스입니다. IAM을 사용하면 AWS 계정 내에서 사용자와 그룹을 생성하고 관리하며, 다양한 AWS 리소스에 대한 액세스 권한을 부여하거나 제한할 수 있습니다.

**비유**: IAM은 건물의 보안 시스템과 같습니다. 건물 소유자(AWS 계정 소유자)는 다양한 방에 대한 접근 권한을 가진 키카드(IAM 정책)를 직원(IAM 사용자)에게 발급합니다. 일부 직원은 특정 부서(IAM 그룹)에 속해 있어 해당 부서의 모든 구성원이 동일한 방에 접근할 수 있습니다. 또한, 방문객(외부 서비스 또는 애플리케이션)에게는 임시 배지(IAM 역할)를 제공하여 제한된 시간 동안 특정 구역에 접근할 수 있게 합니다.

### IAM의 주요 목적
1. **액세스 관리**: AWS 리소스에 대한 액세스를 세밀하게 제어
2. **최소 권한 원칙 적용**: 작업 수행에 필요한 최소한의 권한만 부여
3. **자격 증명 관리**: AWS 계정 내에서 사용자, 그룹, 역할 관리
4. **권한 위임**: 타사 또는 다른 AWS 계정에 제한된 권한 위임
5. **중앙 집중식 제어**: AWS 계정 내 모든 리소스에 대한 액세스 정책 중앙 관리
6. **보안 강화**: 다중 인증(MFA), 암호 정책 등을 통한 보안 강화

### IAM의 주요 특징
- **AWS 계정에 기본 포함**: 추가 비용 없이 AWS 계정에 포함
- **글로벌 서비스**: 리전에 종속되지 않고 전 세계적으로 동일하게 적용
- **세분화된 권한**: 특정 리소스에 대한 특정 작업을 허용하거나 거부
- **자격 증명 페더레이션**: 외부 자격 증명 공급자와 통합 가능
- **다중 인증(MFA) 지원**: 추가 보안 계층 제공
- **무료 서비스**: IAM 사용에 대한 추가 요금 없음

## IAM의 핵심 구성 요소

### IAM 사용자
IAM 사용자는 AWS와 상호 작용하는 개인 또는 서비스를 나타내는 AWS 자격 증명입니다. 각 사용자는 고유한 보안 자격 증명을 가지며, AWS 계정 내에서 특정 권한을 부여받습니다.

**주요 특징**:
- 고유한 이름과 ARN(Amazon Resource Name) 보유
- 장기 자격 증명(암호, 액세스 키) 사용
- AWS Management Console, AWS CLI, AWS SDK를 통한 액세스
- 기본적으로 권한 없음 (명시적으로 부여해야 함)
- 사람 또는 애플리케이션/서비스 대표 가능

**사용자 유형**:
1. **인간 사용자**: AWS Management Console에 로그인하는 실제 사람
   - 콘솔 액세스를 위한 암호 사용
   - MFA 구성 권장
   - 개인별 고유 사용자 생성 권장

2. **시스템 사용자**: AWS API를 호출하는 애플리케이션
   - 액세스 키 ID 및 비밀 액세스 키 사용
   - 가능한 경우 IAM 역할 사용 권장
   - 액세스 키 정기적 교체 필요

### IAM 그룹
IAM 그룹은 IAM 사용자의 모음입니다. 그룹을 사용하면 여러 사용자에 대한 권한을 더 쉽게 관리할 수 있습니다. 정책을 그룹에 연결하면 해당 그룹의 모든 사용자가 자동으로 해당 권한을 상속받습니다.

**주요 특징**:
- 사용자 관리 간소화
- 권한 관리 효율성 향상
- 역할 기반 액세스 제어 지원
- 사용자는 여러 그룹에 속할 수 있음
- 그룹은 다른 그룹의 멤버가 될 수 없음
- 그룹은 자격 증명이 아니므로 리소스 정책에서 참조할 수 없음

**일반적인 그룹 구성 예시**:
- Administrators: 모든 AWS 서비스에 대한 전체 액세스
- Developers: 개발 환경에 대한 액세스
- Operations: 운영 관련 서비스에 대한 액세스
- Security: 보안 관련 서비스에 대한 액세스
- ReadOnly: 모든 리소스에 대한 읽기 전용 액세스

### IAM 역할
IAM 역할은 특정 권한을 가진 AWS 자격 증명으로, 필요한 엔터티가 맡을 수 있습니다. 역할은 장기 자격 증명을 사용하지 않고 임시 자격 증명을 제공합니다.

**비유**: IAM 역할은 호텔 객실 키카드와 같습니다. 체크인할 때 특정 객실에 대한 액세스 권한이 있는 키카드를 받고, 체크아웃할 때 반납합니다. 키카드는 특정 기간 동안만 유효하며, 여러 사람이 같은 객실에 머물 때 동일한 액세스 권한을 가질 수 있습니다.

**주요 특징**:
- 임시 자격 증명 사용
- 신뢰 정책과 권한 정책으로 구성
- 장기 자격 증명 불필요
- 권한 위임 메커니즘 제공
- AWS 서비스, 외부 사용자, 다른 AWS 계정에 권한 부여 가능

**일반적인 역할 사용 사례**:
1. **AWS 서비스 역할**: AWS 서비스가 사용자를 대신하여 작업 수행
   - 예: EC2 인스턴스가 S3 버킷에 액세스
   - 예: Lambda 함수가 DynamoDB 테이블에 액세스

2. **교차 계정 액세스**: 다른 AWS 계정의 사용자에게 권한 위임
   - 예: 개발 계정의 사용자가 운영 계정의 리소스에 액세스

3. **ID 페더레이션**: 외부 ID 공급자를 통해 인증된 사용자에게 AWS 액세스 제공
   - 예: Active Directory, Google, Facebook 사용자에게 AWS 액세스 제공

4. **애플리케이션 코드 내 임시 자격 증명**: 애플리케이션에서 AWS 리소스에 안전하게 액세스
   - 예: 모바일 앱에서 S3 버킷에 직접 업로드

### IAM 정책
IAM 정책은 AWS 서비스와 리소스에 대한 권한을 정의하는 JSON 문서입니다. 정책은 사용자, 그룹 또는 역할에 연결되어 해당 엔터티가 수행할 수 있는 작업을 결정합니다.

**주요 특징**:
- JSON 형식으로 작성
- 명시적 허용 또는 거부 규칙 정의
- 기본적으로 모든 액세스 거부
- 여러 정책이 적용될 경우 평가 규칙 존재
- 세분화된 권한 제어 가능

**정책 유형**:
1. **자격 증명 기반 정책**: IAM 자격 증명(사용자, 그룹, 역할)에 연결
   - **관리형 정책**: 독립적인 정책으로, 여러 자격 증명에 연결 가능
     - **AWS 관리형 정책**: AWS에서 생성 및 관리
     - **고객 관리형 정책**: 사용자가 생성 및 관리
   - **인라인 정책**: 특정 사용자, 그룹 또는 역할에 직접 포함된 정책

2. **리소스 기반 정책**: AWS 리소스에 직접 연결
   - 예: S3 버킷 정책, SQS 대기열 정책, Lambda 함수 정책
   - 리소스에 액세스할 수 있는 주체(사용자, 역할, 다른 AWS 계정 등) 지정

3. **권한 경계**: 자격 증명 기반 정책이 부여할 수 있는 최대 권한 설정
   - 권한을 부여하지 않고 최대 권한 범위만 설정
   - 주로 권한 위임 시나리오에서 사용

4. **서비스 제어 정책(SCP)**: AWS Organizations에서 조직 또는 OU에 대한 최대 권한 정의
   - 조직 내 모든 계정에 적용
   - 권한을 부여하지 않고 가드레일 역할

5. **세션 정책**: 역할 수임 또는 페더레이션 사용자 세션 시 권한 제한
   - 임시 세션의 권한 범위 축소
   - 원래 정책보다 더 많은 권한 부여 불가

### 정책 구조
IAM 정책은 다음과 같은 요소로 구성됩니다:

```json
{
  "Version": "2012-10-17",
  "Id": "S3AccessPolicy",
  "Statement": [
    {
      "Sid": "AllowS3ReadAccess",
      "Effect": "Allow",
      "Principal": {
        "AWS": "arn:aws:iam::123456789012:user/Bob"
      },
      "Action": [
        "s3:GetObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::example-bucket",
        "arn:aws:s3:::example-bucket/*"
      ],
      "Condition": {
        "IpAddress": {
          "aws:SourceIp": "192.0.2.0/24"
        }
      }
    }
  ]
}
```

**주요 요소**:
- **Version**: 정책 언어 버전 (항상 "2012-10-17" 사용 권장)
- **Id**: 정책의 선택적 식별자
- **Statement**: 권한 설명의 배열
  - **Sid**: 설명문의 선택적 식별자
  - **Effect**: 설명문이 액세스를 허용("Allow")하는지 거부("Deny")하는지 지정
  - **Principal**: 정책이 적용되는 계정, 사용자, 역할 또는 서비스 (자격 증명 기반 정책에서는 생략)
  - **Action**: 허용하거나 거부할 서비스 작업
  - **Resource**: 작업이 적용되는 AWS 리소스
  - **Condition**: 정책이 적용되는 조건 (선택 사항)

## IAM 작동 방식

### 인증 및 권한 부여 프로세스
AWS에서 요청이 처리되는 방식을 이해하는 것은 IAM의 작동 방식을 이해하는 데 중요합니다.

**인증 프로세스**:
1. 사용자가 AWS에 요청을 보냄 (콘솔, CLI, SDK 등을 통해)
2. AWS가 요청자의 자격 증명을 확인
   - 콘솔 액세스: 사용자 이름 및 암호 (+ MFA)
   - 프로그래밍 방식 액세스: 액세스 키 또는 임시 보안 자격 증명
3. 자격 증명이 유효하면 인증 성공

**권한 부여 프로세스**:
1. AWS가 요청에 적용되는 모든 정책을 평가
   - 자격 증명 기반 정책
   - 리소스 기반 정책
   - IAM 권한 경계
   - 서비스 제어 정책(SCP)
   - 세션 정책
2. 정책 평가 로직에 따라 요청 허용 또는 거부 결정
3. 결정에 따라 요청 처리 또는 액세스 거부 오류 반환

### 정책 평가 로직
여러 정책이 적용될 때 AWS가 액세스 허용 여부를 결정하는 방법입니다.

**기본 평가 규칙**:
1. 기본적으로 모든 요청은 **묵시적으로 거부**됨
2. 명시적 허용은 묵시적 거부를 재정의
3. 명시적 거부는 모든 허용을 재정의
4. 정책 평가는 요청 컨텍스트에 따라 결정됨

**정책 평가 단계**:
1. **요청 컨텍스트 수집**: 요청자, 작업, 리소스, 환경 데이터
2. **적용 가능한 정책 식별**: 모든 관련 정책 수집
3. **정책 유형별 평가**:
   - 조직 SCP 평가 (명시적 거부 또는 묵시적 허용 확인)
   - 리소스 기반 정책 평가
   - 자격 증명 기반 정책 평가
   - IAM 권한 경계 평가
   - 세션 정책 평가
4. **최종 결정**:
   - 어느 단계에서든 명시적 거부가 있으면 요청 거부
   - 모든 단계에서 허용되면 요청 허용
   - 그 외의 경우 요청 거부

**정책 평가 다이어그램**:
```
요청 → 묵시적 거부 → 조직 SCP → 리소스 정책 → 자격 증명 정책 → 권한 경계 → 세션 정책 → 허용/거부
```

### ARN(Amazon Resource Name)
ARN은 AWS 리소스를 고유하게 식별하는 방법입니다. IAM 정책에서 리소스를 지정할 때 ARN을 사용합니다.

**ARN 형식**:
```
arn:partition:service:region:account-id:resource-type/resource-id
```

**예시**:
- IAM 사용자: `arn:aws:iam::123456789012:user/Bob`
- S3 버킷: `arn:aws:s3:::example-bucket`
- S3 객체: `arn:aws:s3:::example-bucket/file.txt`
- DynamoDB 테이블: `arn:aws:dynamodb:us-west-2:123456789012:table/MyTable`
- EC2 인스턴스: `arn:aws:ec2:us-east-1:123456789012:instance/i-1234567890abcdef0`

### 정책 변수 및 태그
IAM 정책에서 변수와 태그를 사용하여 동적 권한을 구현할 수 있습니다.

**정책 변수**:
- `${aws:username}`: 현재 사용자의 이름
- `${aws:userid}`: 현재 사용자의 고유 ID
- `${aws:PrincipalTag/key-name}`: 주체에 연결된 태그
- `${aws:CurrentTime}`: 요청 시간
- `${aws:SourceIp}`: 요청자의 IP 주소

**예시**:
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "s3:ListBucket",
      "Resource": "arn:aws:s3:::mybucket",
      "Condition": {
        "StringLike": {
          "s3:prefix": [
            "",
            "home/",
            "home/${aws:username}/*"
          ]
        }
      }
    }
  ]
}
```

**속성 기반 액세스 제어(ABAC)**:
태그를 사용하여 권한을 동적으로 제어하는 방법입니다.

```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": "ec2:StartInstances",
      "Resource": "*",
      "Condition": {
        "StringEquals": {
          "aws:ResourceTag/Department": "${aws:PrincipalTag/Department}"
        }
      }
    }
  ]
}
```

## IAM 보안 모범 사례

### 루트 사용자 보호
AWS 계정의 루트 사용자는 모든 권한을 가지고 있으므로 특별한 보호가 필요합니다.

**모범 사례**:
- 루트 사용자 사용 최소화
- 루트 사용자에 강력한 암호 설정
- 루트 사용자에 MFA 활성화
- 루트 사용자 액세스 키 생성 금지
- 루트 사용자 자격 증명 공유 금지
- 정기적인 루트 사용자 자격 증명 감사

### 최소 권한 원칙 적용
사용자와 역할에 작업 수행에 필요한 최소한의 권한만 부여합니다.

**모범 사례**:
- 광범위한 권한으로 시작하지 않기
- 작업에 필요한 특정 권한만 부여
- AWS Access Analyzer를 사용하여 사용하지 않는 권한 식별
- 정기적으로 권한 검토 및 불필요한 권한 제거
- 권한 경계를 사용하여 최대 권한 제한
- 정책 조건을 사용하여 액세스 제한

### 그룹을 사용한 권한 관리
개별 사용자가 아닌 그룹에 권한을 할당하여 관리를 간소화합니다.

**모범 사례**:
- 공통 책임 또는 작업 기능에 따라 그룹 생성
- 그룹에 정책 연결
- 사용자를 적절한 그룹에 배치
- 개별 사용자에게 직접 권한 할당 지양
- 정기적으로 그룹 구성원 및 권한 검토

### 강력한 암호 정책 적용
강력한 암호 정책을 통해 무단 액세스 위험을 줄입니다.

**모범 사례**:
- 최소 암호 길이 요구
- 복잡성 요구 사항 적용 (대문자, 소문자, 숫자, 특수 문자)
- 암호 재사용 방지
- 정기적인 암호 변경 요구
- 암호 만료 정책 설정

### MFA 활성화
다중 인증(MFA)을 사용하여 보안 계층을 추가합니다.

**모범 사례**:
- 모든 IAM 사용자에 대해 MFA 활성화
- 특히 권한이 높은 사용자에 대해 MFA 필수화
- 다양한 MFA 옵션 제공 (가상 MFA, U2F 보안 키, 하드웨어 토큰)
- MFA 디바이스 분실 시 복구 절차 수립
- 조건부 정책을 사용하여 MFA 없이 특정 작업 제한

### 액세스 키 보안
프로그래밍 방식 액세스를 위한 액세스 키를 안전하게 관리합니다.

**모범 사례**:
- 액세스 키 정기적 교체
- 사용하지 않는 액세스 키 비활성화 및 삭제
- 액세스 키를 소스 코드나 공개 저장소에 저장하지 않기
- 가능한 경우 액세스 키 대신 IAM 역할 사용
- AWS CloudTrail을 사용하여 액세스 키 사용 모니터링

### IAM 자격 증명 보고서 및 액세스 분석기 활용
AWS 제공 도구를 사용하여 IAM 보안 상태를 모니터링하고 개선합니다.

**모범 사례**:
- 정기적으로 IAM 자격 증명 보고서 생성 및 검토
- AWS Access Analyzer를 사용하여 외부 액세스 식별
- 마지막 사용 정보를 기반으로 미사용 자격 증명 제거
- IAM Access Analyzer 정책 검증 도구 활용
- AWS Trusted Advisor 보안 검사 활용

### 임시 자격 증명 사용
가능한 경우 장기 자격 증명 대신 임시 자격 증명을 사용합니다.

**모범 사례**:
- EC2 인스턴스에 IAM 역할 사용
- 교차 계정 액세스에 역할 사용
- 페더레이션 ID 사용
- AWS STS를 사용하여 임시 자격 증명 발급
- 임시 자격 증명의 수명 제한

## IAM 자격 증명 센터 (이전 AWS SSO)

### 개요
AWS IAM Identity Center는 AWS 계정 및 클라우드 애플리케이션에 대한 SSO(Single Sign-On) 액세스를 중앙에서 관리하는 서비스입니다.

**주요 기능**:
- 여러 AWS 계정에 대한 중앙 집중식 액세스 관리
- 기업 디렉터리 통합 (Active Directory, SAML 2.0 IdP)
- 세분화된 권한 관리
- 사용자 포털을 통한 간편한 액세스
- 다중 계정 권한 세트

### 작동 방식
1. 사용자가 IAM Identity Center 포털에 로그인
2. 사용자에게 할당된 AWS 계정 및 애플리케이션 표시
3. 사용자가 계정 또는 애플리케이션 선택
4. IAM Identity Center가 해당 리소스에 대한 임시 자격 증명 제공
5. 사용자가 선택한 리소스에 액세스

### 권한 세트
권한 세트는 사용자와 그룹이 AWS 계정에서 가질 수 있는 액세스 수준을 정의합니다.

**일반적인 권한 세트**:
- AdministratorAccess
- PowerUserAccess
- ReadOnlyAccess
- 사용자 지정 권한 세트

### 기업 디렉터리 통합
IAM Identity Center는 다양한 ID 소스와 통합할 수 있습니다.

**지원되는 ID 소스**:
- IAM Identity Center 디렉터리
- Active Directory (AWS Managed Microsoft AD)
- 외부 SAML 2.0 ID 공급자 (Okta, Azure AD 등)

## 결론
AWS IAM은 AWS 리소스에 대한 액세스를 안전하게 제어하는 핵심 서비스입니다. 사용자, 그룹, 역할, 정책과 같은 IAM의 핵심 구성 요소를 이해하고, 최소 권한 원칙, 강력한 암호 정책, MFA 활성화 등의 보안 모범 사례를 적용함으로써 AWS 환경의 보안을 크게 강화할 수 있습니다. IAM을 효과적으로 사용하면 조직의 보안 요구 사항을 충족하면서도 사용자와 애플리케이션이 필요한 AWS 리소스에 액세스할 수 있도록 보장할 수 있습니다.

## 참고 자료
- [AWS IAM 사용 설명서](https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html)
- [IAM 모범 사례](https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html)
- [AWS 보안 블로그 - IAM 관련 게시물](https://aws.amazon.com/blogs/security/category/security-identity-compliance/aws-identity-and-access-management-iam/)
- [IAM 정책 참조](https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_policies.html)
- [IAM Identity Center 설명서](https://docs.aws.amazon.com/singlesignon/latest/userguide/what-is.html)