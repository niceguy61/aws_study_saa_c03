# VPC 네트워킹 심화

## 슬라이드 1: VPC 네트워킹 개요
- VPC 네트워킹은 AWS 클라우드 내 가상 네트워크 환경의 핵심
- 다양한 네트워킹 구성 요소를 통한 트래픽 라우팅 및 제어
- 온프레미스 네트워크와의 하이브리드 연결 옵션
- 보안, 가용성, 성능을 고려한 네트워크 설계
- **목표**: 안전하고 확장 가능하며 고성능의 네트워크 아키텍처 구현

## 슬라이드 2: 인터넷 게이트웨이(IGW) 심화
- VPC와 인터넷 간의 통신을 가능하게 하는 게이트웨이
- **주요 기능**:
  - 라우팅 대상 제공: VPC 라우팅 테이블에서 인터넷 트래픽의 대상으로 사용
  - 네트워크 주소 변환(NAT): 퍼블릭 IP 주소가 할당된 인스턴스에 대해 NAT 수행
- **비유**: 건물의 정문과 같은 역할
- **특징**:
  - 단일 연결: 하나의 VPC에는 하나의 인터넷 게이트웨이만 연결 가능
  - 고가용성: AWS에서 자동으로 중복성 및 고가용성 제공
  - 대역폭 제한 없음: 트래픽 양에 따라 자동으로 확장

## 슬라이드 3: NAT 게이트웨이 및 NAT 인스턴스 심화
- 프라이빗 서브넷의 인스턴스가 인터넷에 액세스할 수 있게 해주는 서비스
- **NAT 게이트웨이 vs NAT 인스턴스**:
  - 관리: AWS 관리형 vs 사용자 관리형
  - 가용성: 고가용성(단일 AZ 내) vs 수동 구성 필요
  - 대역폭: 최대 45Gbps, 자동 확장 vs 인스턴스 유형에 따라 제한
  - 보안 그룹: 연결 불가 vs 연결 가능
- **비유**: 호텔의 프론트 데스크와 같은 역할
- **모범 사례**: 각 가용 영역에 별도의 NAT 게이트웨이 배포

## 슬라이드 4: 이그레스 전용 인터넷 게이트웨이
- IPv6 트래픽에 대해 NAT 게이트웨이와 유사한 기능 제공
- 프라이빗 서브넷의 인스턴스가 IPv6를 통해 인터넷에 액세스 가능
- 인터넷에서 인스턴스로의 직접 액세스는 방지
- **주요 특징**:
  - IPv6 전용: IPv6 트래픽에만 사용됨 (IPv4에는 NAT 게이트웨이 필요)
  - 상태 저장 방식: 아웃바운드 트래픽에 대한 응답 인바운드 트래픽 허용
  - 수평적 확장: 트래픽 요구 사항에 따라 자동 확장
  - 비용: 추가 비용 없음 (데이터 전송 요금만 적용)

## 슬라이드 5: VPC 피어링 심화
- 두 VPC 간에 트래픽을 라우팅할 수 있게 해주는 네트워킹 연결
- VPC가 마치 동일한 네트워크에 있는 것처럼 통신 가능
- **고급 구성 및 제한 사항**:
  - CIDR 중복: 피어링된 VPC 간에 CIDR 블록이 중복되면 통신 불가
  - 전이적 피어링 미지원: A-B, B-C가 피어링되어 있어도 A-C 간 직접 통신 불가
  - 리전 간 피어링: 서로 다른 리전의 VPC 간 피어링 지원
  - 계정 간 피어링: 서로 다른 AWS 계정의 VPC 간 피어링 지원
- **일반적인 사용 사례**:
  - 리소스 공유: 여러 VPC 간에 공통 리소스 공유
  - 애플리케이션 분리: 애플리케이션 구성 요소를 별도의 VPC로 분리하면서 통신 유지

## 슬라이드 6: AWS Transit Gateway 심화
- VPC와 온프레미스 네트워크를 연결하는 중앙 허브 역할
- 복잡한 피어링 관계를 단순화하고 확장 가능한 네트워크 아키텍처 구축
- **비유**: 대도시의 중앙 교통 허브와 같은 역할
- **고급 기능 및 특징**:
  - 중앙 집중식 연결: 여러 VPC, VPN 및 Direct Connect 게이트웨이를 단일 지점에 연결
  - 전이적 라우팅: 연결된 모든 네트워크 간 전이적 라우팅 지원
  - 라우팅 테이블: 여러 라우팅 테이블을 통한 세분화된 트래픽 제어
  - 대역폭: 연결당 최대 50Gbps, 자동 확장
  - 리전 간 피어링: 서로 다른 리전의 Transit Gateway 간 피어링 지원

## 슬라이드 7: Transit Gateway 라우팅
- Transit Gateway는 여러 라우팅 테이블을 지원하여 복잡한 라우팅 시나리오 구현
- **주요 개념**:
  - 기본 라우팅 테이블: 모든 연결이 기본적으로 연결되는 라우팅 테이블
  - 사용자 정의 라우팅 테이블: 특정 연결 또는 연결 그룹에 대한 사용자 정의 라우팅
  - 라우팅 전파: 연결에서 CIDR 블록을 자동으로 라우팅 테이블에 전파 가능
  - 블랙홀 라우팅: 특정 CIDR 블록에 대한 트래픽 차단
- **네트워크 세분화 전략**:
  - 격리된 라우팅 도메인: 여러 라우팅 테이블을 사용하여 격리된 라우팅 도메인 생성
  - 선택적 연결: 특정 VPC 간에만 통신 허용
  - 검사 VPC: 모든 트래픽을 검사 VPC로 라우팅하여 중앙 집중식 보안 제어 구현

## 슬라이드 8: VPC 엔드포인트 심화
- 인터넷 게이트웨이, NAT 장치, VPN 연결 또는 AWS Direct Connect 연결 없이도 AWS 서비스에 비공개로 연결
- **게이트웨이 엔드포인트 vs 인터페이스 엔드포인트**:
  - 게이트웨이 엔드포인트: S3, DynamoDB 전용, 라우팅 테이블 항목, 무료
  - 인터페이스 엔드포인트: 대부분의 AWS 서비스, ENI 기반, 시간당 요금 발생
- **게이트웨이 엔드포인트 고급 구성**:
  - 라우팅 테이블 통합: 특정 라우팅 테이블과 연결
  - 접두사 목록: AWS 서비스의 IP 범위를 대상으로 하는 라우팅 테이블 항목 생성
  - 엔드포인트 정책: 엔드포인트를 통한 액세스 제어
- **인터페이스 엔드포인트 고급 구성**:
  - 가용 영역 배포: 각 가용 영역에 별도의 ENI 배포 가능
  - 프라이빗 DNS: AWS 서비스의 기본 DNS 이름을 사용하여 액세스 가능
  - 보안 그룹: ENI에 보안 그룹 연결하여 트래픽 제어

## 슬라이드 9: AWS PrivateLink
- VPC, AWS 서비스 및 온프레미스 애플리케이션 간에 프라이빗 연결 제공
- 인터페이스 VPC 엔드포인트의 기반 기술
- **주요 특징**:
  - 프라이빗 연결: 공용 인터넷을 통과하지 않는 프라이빗 연결
  - 서비스 제공: 자체 서비스를 다른 AWS 고객에게 제공 가능
  - 확장성: 수천 개의 VPC에서 동시에 액세스 가능
  - 보안: 트래픽이 공용 인터넷에 노출되지 않음
- **일반적인 사용 사례**:
  - SaaS 통합: SaaS 제품을 고객 VPC와 안전하게 통합
  - 공유 서비스: 여러 VPC 간에 공통 서비스 공유
  - 하이브리드 클라우드: 온프레미스 애플리케이션과 AWS 서비스 간의 프라이빗 연결

## 슬라이드 10: 라우팅 테이블 고급 기능
- VPC 내의 네트워크 트래픽 흐름을 제어하는 핵심 구성 요소
- **라우팅 우선순위 규칙**:
  1. 가장 구체적인 경로: 가장 긴 접두사 일치 (예: /32가 /16보다 우선)
  2. 정적 경로: 수동으로 구성된 경로
  3. 전파된 경로: VPN 또는 Direct Connect를 통해 전파된 경로
  4. 동적 경로: BGP를 통해 학습된 경로
  5. 기본 경로: 가장 일반적인 경로 (0.0.0.0/0 또는 ::/0)
- **고급 라우팅 시나리오**:
  - 접두사 목록 참조: 여러 CIDR 블록을 하나의 접두사 목록으로 그룹화하여 참조
  - 블랙홀 라우팅: 특정 대상에 대한 트래픽 차단
  - 더 구체적인 경로 추가: 특정 트래픽을 다른 경로로 유도

## 슬라이드 11: 보안 그룹 고급 기능
- 인스턴스 수준에서 작동하는 상태 저장 방화벽
- **상태 저장 특성의 영향**:
  - 반환 트래픽 자동 허용: 허용된 인바운드 트래픽에 대한 응답은 아웃바운드 규칙에 관계없이 자동으로 허용
  - 연결 추적: 각 연결의 상태를 추적하여 유효한 반환 트래픽 식별
  - 연결 제한 시간: 비활성 연결은 일정 시간 후 제거됨 (TCP: 600초, UDP: 180초)
- **보안 그룹 참조**:
  - 동일 VPC 내: 동일한 VPC 내의 다른 보안 그룹 참조 가능
  - 피어링된 VPC: 동일한 리전 내에서 피어링된 VPC의 보안 그룹 참조 가능
  - 자체 참조: 보안 그룹이 자신을 참조하여 동일한 보안 그룹에 속한 인스턴스 간 통신 허용 가능

## 슬라이드 12: 네트워크 ACL 고급 기능
- 서브넷 수준에서 작동하는 상태 비저장 방화벽
- **상태 비저장 특성의 영향**:
  - 인바운드/아웃바운드 규칙 분리: 인바운드 및 아웃바운드 트래픽에 대해 별도의 규칙 필요
  - 반환 트래픽 명시적 허용: 반환 트래픽을 위한 규칙을 명시적으로 구성해야 함
  - 임시 포트 고려: 클라이언트의 임시 포트(1024-65535)에 대한 아웃바운드/인바운드 규칙 필요
- **규칙 평가 순서**:
  - 낮은 번호 우선: 가장 낮은 번호의 규칙부터 평가
  - 첫 번째 일치 적용: 트래픽과 일치하는 첫 번째 규칙이 적용됨
  - 기본 규칙: 다른 규칙과 일치하지 않는 경우 기본 규칙(번호 *) 적용

## 슬라이드 13: NACL vs 보안 그룹 활용 전략
- NACL과 보안 그룹은 상호 보완적인 보안 계층 제공
- **NACL 사용 사례**:
  - 기본 방어 계층
  - 특정 IP 차단
  - 서브넷 수준 격리
- **보안 그룹 사용 사례**:
  - 인스턴스 수준 제어
  - 애플리케이션 계층 보안
  - 동적 규칙 참조
  - 상태 저장 검사
- **모범 사례**:
  - 기본 거부: 기본적으로 모든 트래픽을 거부하고 필요한 트래픽만 명시적으로 허용
  - 계층적 방어: NACL을 보안 그룹과 함께 사용하여 심층 방어 구현
  - 임시 포트 범위 고려: 클라이언트 임시 포트에 대한 규칙 포함

## 슬라이드 14: AWS Site-to-Site VPN 심화
- 온프레미스 네트워크와 AWS VPC 간에 암호화된 연결 제공
- **고급 구성 옵션**:
  - 가상 프라이빗 게이트웨이(VGW): VPC 측의 VPN 종단점
  - 고객 게이트웨이(CGW): 온프레미스 측의 VPN 종단점
  - 전송 게이트웨이 VPN 연결: Transit Gateway를 VPN 종단점으로 사용
  - 정적 vs 동적 라우팅: BGP(Border Gateway Protocol)를 통한 동적 라우팅 또는 정적 라우팅
  - 중복 터널: 각 VPN 연결에 두 개의 터널 제공 (고가용성)
- **고가용성 VPN 설계**:
  - 중복 고객 게이트웨이: 서로 다른 위치 또는 장치에 여러 고객 게이트웨이 구성
  - Transit Gateway 활용: 여러 VPC에 대한 중복 VPN 연결 단순화
  - BGP 라우팅: 동적 라우팅을 통한 자동 장애 조치

## 슬라이드 15: AWS Direct Connect 심화
- 온프레미스 네트워크와 AWS 간에 전용 네트워크 연결 제공
- **연결 유형 및 용량**:
  - 전용 연결: 1Gbps, 10Gbps, 100Gbps 용량
  - 호스팅 연결: 50Mbps ~ 10Gbps 다양한 용량
  - Direct Connect 게이트웨이: 여러 리전의 VPC에 연결
  - LAG(Link Aggregation Group): 여러 연결을 하나의 논리적 연결로 결합
- **가상 인터페이스(VIF) 유형**:
  - 프라이빗 VIF: VPC에 대한 프라이빗 연결
  - 퍼블릭 VIF: AWS 퍼블릭 서비스에 대한 연결
  - 전송 VIF: Direct Connect 게이트웨이를 통한 Transit Gateway 연결
- **고가용성 설계**:
  - 여러 위치: 서로 다른 Direct Connect 위치에 연결
  - 여러 서비스 제공업체: 서로 다른 서비스 제공업체를 통한 연결
  - VPN 백업: Direct Connect 장애 시 VPN으로 장애 조치

## 슬라이드 16: 하이브리드 연결 패턴
- 다양한 하이브리드 연결 패턴을 통해 온프레미스 네트워크와 AWS 클라우드를 효과적으로 통합
- **VPN 전용 패턴**:
  - 장점: 구현 용이성, 낮은 초기 비용, 빠른 설정
  - 단점: 대역폭 제한, 인터넷 의존성, 변동성 있는 지연 시간
  - 사용 사례: 소규모 워크로드, 개발/테스트 환경, 임시 연결
- **Direct Connect 전용 패턴**:
  - 장점: 일관된 성능, 높은 대역폭, 낮은 지연 시간, 예측 가능한 비용
  - 단점: 높은 초기 비용, 긴 설정 시간, 단일 연결 시 장애 지점
  - 사용 사례: 대규모 데이터 전송, 지연 시간에 민감한 애플리케이션
- **Direct Connect + VPN 백업 패턴**:
  - 장점: 고가용성, Direct Connect의 성능과 VPN의 중복성 결합
  - 단점: 구성 복잡성, 두 연결 유형 모두에 대한 비용
  - 사용 사례: 미션 크리티컬 워크로드, 고가용성이 필요한 프로덕션 환경

## 슬라이드 17: VPC 흐름 로그
- VPC의 네트워크 인터페이스에서 송수신되는 IP 트래픽에 대한 정보 캡처
- **고급 구성 옵션**:
  - 집계 간격: 1분 또는 10분 (기본값: 10분)
  - 로그 형식 사용자 지정: 캡처할 필드 선택
  - 파티션 기준: 시간별 또는 접두사별 로그 파티션
  - 로그 대상: CloudWatch Logs, S3, Kinesis Data Firehose
- **흐름 로그 분석 및 활용**:
  - 보안 분석: 비정상적인 트래픽 패턴 및 잠재적 보안 위협 식별
  - 네트워크 문제 해결: 연결 문제 및 라우팅 오류 진단
  - 규정 준수: 네트워크 트래픽 감사 및 규정 준수 요구 사항 충족
  - 최적화: 네트워크 사용 패턴 분석 및 최적화 기회 식별

## 슬라이드 18: 네트워크 문제 해결 기법
- VPC 네트워킹 문제를 효과적으로 진단하고 해결하기 위한 체계적인 접근 방식
- **연결 문제 해결**:
  1. 기본 연결 확인: 인스턴스 상태, 보안 그룹, NACL, 라우팅 테이블 검토
  2. 인터넷 연결 문제: IGW 연결, 퍼블릭 IP, 라우팅 테이블 확인
  3. VPC 피어링 문제: 피어링 상태, 라우팅 테이블, CIDR 중복 확인
  4. VPN 연결 문제: 터널 상태, 게이트웨이 구성, BGP 상태 확인
  5. Direct Connect 문제: 물리적 연결 상태, 가상 인터페이스 상태, BGP 피어링 확인
- **네트워크 성능 문제 해결**:
  1. 대역폭 병목 현상: 인스턴스 유형의 네트워크 성능 제한 확인
  2. 지연 시간 문제: 리소스 위치, 네트워크 경로, MTU 설정 확인
  3. 패킷 손실: 네트워크 인터페이스 오류, 흐름 로그, 대역폭 제한 확인

## 슬라이드 19: 문제 해결 도구
- **VPC 흐름 로그**: 네트워크 트래픽 분석
- **CloudWatch 지표**: 네트워크 성능 모니터링
- **VPC Reachability Analyzer**: 네트워크 경로 분석
- **EC2 인스턴스 연결 테스트**: 기본 연결 확인
- **traceroute 및 ping**: 네트워크 경로 및 지연 시간 확인
- **tcpdump**: 패킷 수준 분석
- **AWS Network Manager**: 글로벌 네트워크 가시성

## 슬라이드 20: 핵심 요약 및 Q&A
- VPC 네트워킹은 AWS 클라우드 인프라의 핵심 구성 요소
- 다양한 네트워킹 구성 요소, 연결 옵션, 트래픽 라우팅 및 제어 방법 이해 필요
- 하이브리드 네트워킹 구성을 통해 온프레미스 환경과 AWS 클라우드 통합
- 효과적인 문제 해결 및 모니터링 기법을 활용하여 네트워크 문제 신속하게 진단 및 해결
- 질문 및 토론