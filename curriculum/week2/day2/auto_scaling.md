# Auto Scaling 개념 및 구성

## 개요
Amazon EC2 Auto Scaling은 애플리케이션의 로드를 처리하기 위해 적절한 수의 EC2 인스턴스를 자동으로 유지하도록 도와주는 서비스입니다. 이 강의에서는 Auto Scaling의 기본 개념, 작동 방식, 그리고 고가용성 아키텍처에서의 활용 방법을 알아봅니다.

## 학습 목표
- Auto Scaling의 개념과 이점 이해
- Auto Scaling 그룹 구성 요소 및 작동 방식 학습
- 다양한 조정 정책 유형 및 적용 방법 이해
- Auto Scaling을 활용한 고가용성 아키텍처 설계 방법 습득

## Auto Scaling이란?

### 기본 개념
Auto Scaling은 애플리케이션의 수요에 따라 EC2 인스턴스의 수를 자동으로 조정하는 기능입니다. 트래픽이 증가하면 인스턴스를 추가하고, 트래픽이 감소하면 인스턴스를 제거하여 성능을 유지하면서 비용을 최적화합니다.

**비유**: Auto Scaling은 마치 식당에서 손님이 많을 때 직원을 더 투입하고, 손님이 적을 때 직원을 줄이는 것과 같습니다. 필요한 만큼만 리소스를 사용하여 효율성을 극대화합니다.

### Auto Scaling의 주요 이점
- **고가용성 보장**: 장애가 발생한 인스턴스를 자동으로 교체
- **비용 최적화**: 필요한 용량만 사용하여 비용 절감
- **자동화된 용량 관리**: 수동 개입 없이 용량 조정
- **예측 가능한 성능**: 부하 증가에도 일관된 성능 유지
- **유연한 확장**: 다양한 조건에 따른 확장 정책 구성 가능

## Auto Scaling 그룹의 구성 요소

### 1. 시작 템플릿 또는 구성
Auto Scaling 그룹이 새 인스턴스를 시작할 때 사용하는 템플릿입니다.

**포함 정보**:
- AMI ID
- 인스턴스 유형
- 키 페어
- 보안 그룹
- 블록 디바이스 매핑
- 네트워크 설정
- 사용자 데이터 스크립트

**비유**: 시작 템플릿은 새 직원을 채용할 때 사용하는 직무 기술서와 같습니다. 어떤 기술과 자격을 갖춘 사람을 채용할지 정의합니다.

### 2. 그룹 크기 설정
Auto Scaling 그룹이 유지해야 하는 인스턴스 수를 정의합니다.

**주요 설정**:
- **최소 용량**: 항상 유지해야 하는 최소 인스턴스 수
- **최대 용량**: 그룹이 확장될 수 있는 최대 인스턴스 수
- **원하는 용량**: 일반적인 상황에서 유지하려는 인스턴스 수

**비유**: 이는 식당에서 최소 직원 수, 최대 직원 수, 그리고 일반적인 영업일에 필요한 직원 수를 정하는 것과 같습니다.

### 3. 네트워크 및 가용 영역 설정
인스턴스가 시작될 VPC, 서브넷 및 가용 영역을 지정합니다.

**모범 사례**: 여러 가용 영역에 인스턴스를 분산하여 고가용성 확보

**비유**: 이는 여러 지역에 매장을 분산하여 한 지역에 문제가 생겨도 비즈니스가 계속 운영될 수 있도록 하는 것과 같습니다.

### 4. 조정 정책
언제, 어떻게 그룹 크기를 변경할지 정의하는 규칙입니다.

**유형**:
- 대상 추적 조정
- 단계 조정
- 단순 조정
- 예약 조정

**비유**: 조정 정책은 식당에서 손님 수에 따라 직원을 늘리거나 줄이는 규칙과 같습니다. 예를 들어, 대기 시간이 15분 이상이면 직원을 추가하는 규칙을 만들 수 있습니다.

### 5. 상태 확인
인스턴스의 상태를 모니터링하고 비정상 인스턴스를 교체하는 메커니즘입니다.

**유형**:
- EC2 상태 확인
- ELB 상태 확인
- 사용자 정의 상태 확인

**비유**: 이는 직원들의 업무 수행 능력을 모니터링하고, 문제가 있는 직원을 교체하는 것과 같습니다.

## Auto Scaling 작동 방식

### 1. 인스턴스 시작 프로세스
1. 조정 이벤트 발생 (예: CPU 사용률 증가)
2. Auto Scaling 그룹이 새 인스턴스 시작 결정
3. 시작 템플릿/구성에 따라 인스턴스 시작
4. 인스턴스 시작 및 초기화
5. 상태 확인 통과 후 서비스 트래픽 수신

### 2. 인스턴스 종료 프로세스
1. 조정 이벤트 발생 (예: CPU 사용률 감소)
2. Auto Scaling 그룹이 인스턴스 종료 결정
3. 종료 정책에 따라 종료할 인스턴스 선택
4. 연결 드레이닝 (해당하는 경우)
5. 인스턴스 종료

### 3. 상태 확인 및 교체
1. 정기적인 상태 확인 수행
2. 비정상 인스턴스 감지
3. 비정상 인스턴스 종료
4. 새 인스턴스 시작하여 교체
5. 새 인스턴스 초기화 및 서비스 합류

## Auto Scaling 조정 정책 유형

### 1. 대상 추적 조정 정책
특정 지표의 목표값을 설정하고, Auto Scaling이 해당 목표를 유지하도록 자동으로 조정합니다.

**예시**: CPU 사용률을 50%로 유지

**장점**:
- 간단한 설정
- 자동 양방향 조정
- 목표 지표에 비례하여 조정

**비유**: 이는 자동 온도 조절 장치와 같습니다. 목표 온도를 설정하면 시스템이 자동으로 온도를 유지합니다.

### 2. 단계 조정 정책
경보 위반의 크기에 따라 다른 조정 조치를 취합니다.

**예시**:
- CPU > 70%: 2개 인스턴스 추가
- CPU > 85%: 4개 인스턴스 추가

**장점**:
- 위반 정도에 따른 세밀한 조정
- 다양한 지표 사용 가능

**비유**: 이는 교통 혼잡도에 따라 다른 수의 차선을 개방하는 것과 같습니다. 약간 혼잡하면 1개 차선, 매우 혼잡하면 3개 차선을 추가로 개방합니다.

### 3. 단순 조정 정책
경보가 트리거될 때 지정된 수의 인스턴스를 추가하거나 제거합니다.

**예시**: CPU > 70%일 때 2개 인스턴스 추가

**특징**:
- 쿨다운 기간 필요
- 한 번에 하나의 조정 활동만 수행

**비유**: 이는 버스가 만석이 되면 추가 버스를 투입하는 것과 같습니다.

### 4. 예약 조정
예측 가능한 부하 변화에 대비하여 특정 시간에 용량을 조정합니다.

**예시**:
- 매일 오전 9시: 10개 인스턴스로 증가
- 매일 오후 6시: 5개 인스턴스로 감소

**장점**:
- 예측 가능한 패턴에 대한 사전 대응
- 수요 급증 전에 용량 확보

**비유**: 이는 식당에서 점심 시간 전에 미리 직원을 추가하고, 저녁 시간이 끝난 후 직원을 줄이는 것과 같습니다.

## Auto Scaling 종료 정책

Auto Scaling 그룹이 인스턴스를 종료할 때 어떤 인스턴스를 먼저 종료할지 결정하는 정책입니다.

### 기본 종료 정책 순서
1. 가장 많은 인스턴스가 있는 가용 영역에서 인스턴스 선택
2. 가장 오래된 시작 구성/템플릿을 사용하는 인스턴스 선택
3. 다음 청구 시간에 가장 가까운 인스턴스 선택

### 사용자 지정 종료 정책
- OldestInstance: 가장 오래된 인스턴스 먼저 종료
- NewestInstance: 가장 최근 인스턴스 먼저 종료
- OldestLaunchConfiguration: 가장 오래된 시작 구성 사용 인스턴스 종료
- ClosestToNextInstanceHour: 다음 청구 시간에 가장 가까운 인스턴스 종료
- Default: 기본 종료 정책 사용

## Auto Scaling을 활용한 고가용성 아키텍처

### 1. 다중 가용 영역 배포
여러 가용 영역에 인스턴스를 분산하여 단일 가용 영역 장애에도 서비스 지속

**구성 방법**:
- 최소 2개 이상의 가용 영역 선택
- 각 가용 영역에 균등하게 인스턴스 분산
- 가용 영역 재조정 활성화

**비유**: 이는 여러 도시에 사무실을 두어 한 도시에 자연재해가 발생해도 비즈니스가 계속되도록 하는 것과 같습니다.

### 2. 로드 밸런서와 통합
Elastic Load Balancer와 Auto Scaling 그룹을 통합하여 트래픽 분산 및 상태 확인 강화

**이점**:
- 트래픽의 균등한 분산
- 비정상 인스턴스 자동 감지 및 교체
- 연결 드레이닝을 통한 원활한 인스턴스 제거

**비유**: 이는 호텔 프론트 데스크가 객실 상태를 확인하고 손님을 적절한 객실로 안내하는 것과 같습니다.

### 3. 자동 복구 메커니즘
상태 확인을 통해 비정상 인스턴스를 자동으로 감지하고 교체

**구성 방법**:
- EC2 및 ELB 상태 확인 활성화
- 적절한 상태 확인 유예 기간 설정
- 상태 확인 실패 시 인스턴스 교체 자동화

**비유**: 이는 자동차의 타이어 압력 모니터링 시스템이 문제를 감지하고 자동으로 타이어를 교체하는 것과 같습니다.

### 4. 예측적 조정
CloudWatch와 통합하여 과거 패턴을 기반으로 용량을 예측하고 사전에 조정

**이점**:
- 수요 급증 전에 용량 확보
- 더 부드러운 확장 경험
- 리소스 준비 시간 단축

**비유**: 이는 날씨 예보를 보고 우산을 준비하는 것과 같습니다. 비가 오기 전에 미리 대비합니다.

## Auto Scaling 모범 사례

### 1. 적절한 지표 선택
워크로드 특성에 맞는 조정 지표 선택

**일반적인 지표**:
- CPU 사용률
- 네트워크 I/O
- 요청 수/지연 시간
- 사용자 정의 지표

**비유**: 이는 환자의 상태를 평가하기 위해 가장 관련성 높은 생체 신호를 모니터링하는 것과 같습니다.

### 2. 점진적 조정
급격한 용량 변화보다 점진적인 조정 설계

**방법**:
- 적절한 쿨다운 기간 설정
- 단계적 조정 정책 사용
- 과도한 조정 방지를 위한 임계값 설정

**비유**: 이는 차량의 속도를 급격히 변경하지 않고 점진적으로 가속하거나 감속하는 것과 같습니다.

### 3. 시작 템플릿 버전 관리
시작 템플릿의 버전을 관리하여 일관된 배포 보장

**방법**:
- 주요 변경 사항에 대한 새 버전 생성
- 버전에 설명 추가
- 기본 버전 지정

**비유**: 이는 제품의 다양한 버전을 관리하고, 각 버전의 변경 사항을 문서화하는 것과 같습니다.

### 4. 인스턴스 준비 시간 고려
새 인스턴스가 트래픽을 처리할 준비가 되기까지 시간 고려

**방법**:
- 적절한 상태 확인 유예 기간 설정
- 수명 주기 후크를 사용한 초기화 완료 확인
- 사용자 데이터 스크립트 최적화

**비유**: 이는 새 직원이 교육을 받고 업무에 완전히 적응하는 데 필요한 시간을 고려하는 것과 같습니다.

### 5. 비용과 성능 균형
비용 최적화와 성능 요구 사항 사이의 균형 유지

**방법**:
- 적절한 최소/최대 용량 설정
- 예측 가능한 패턴에 예약 조정 사용
- 스팟 인스턴스와 온디맨드 인스턴스 혼합

**비유**: 이는 비용을 절감하면서도 고객 만족도를 유지하는 균형을 찾는 것과 같습니다.

## Auto Scaling 고급 기능

### 1. 수명 주기 후크
인스턴스 시작 또는 종료 프로세스 중에 사용자 지정 작업 수행

**사용 사례**:
- 인스턴스 시작 시 추가 설정 수행
- 종료 전 데이터 백업 또는 정리
- 외부 시스템에 알림

**비유**: 이는 직원이 입사하거나 퇴사할 때 수행해야 하는 체크리스트와 같습니다.

### 2. 인스턴스 보호
특정 인스턴스를 조정 이벤트로부터 보호

**사용 사례**:
- 중요한 작업을 수행 중인 인스턴스 보호
- 디버깅 중인 인스턴스 유지
- 수동으로 추가된 특수 인스턴스 보존

**비유**: 이는 특별한 임무를 수행 중인 직원을 인력 감축에서 제외하는 것과 같습니다.

### 3. 혼합 인스턴스 정책
다양한 인스턴스 유형과 구매 옵션을 혼합하여 비용 최적화

**구성 요소**:
- 기본 인스턴스 유형
- 대체 인스턴스 유형 목록
- 온디맨드 vs 스팟 인스턴스 비율
- 스팟 할당 전략

**비유**: 이는 정규직, 계약직, 임시직 직원을 적절히 혼합하여 비용을 최적화하는 것과 같습니다.

### 4. 예측적 조정
과거 데이터를 분석하여 미래 용량 요구 사항을 예측하고 사전에 조정

**이점**:
- 수요 급증 전에 용량 확보
- 반응형 조정의 지연 시간 방지
- 더 부드러운 확장 경험

**비유**: 이는 과거 판매 데이터를 분석하여 휴가철 수요를 예측하고 미리 재고를 확보하는 것과 같습니다.

## 결론
Amazon EC2 Auto Scaling은 애플리케이션의 가용성을 향상시키고 비용을 최적화하는 강력한 도구입니다. 다양한 조정 정책, 상태 확인, 종료 정책을 통해 워크로드 요구 사항에 맞게 유연하게 구성할 수 있습니다. 여러 가용 영역에 걸친 배포와 로드 밸런서 통합을 통해 고가용성 아키텍처를 구축할 수 있으며, 수명 주기 후크, 인스턴스 보호, 혼합 인스턴스 정책과 같은 고급 기능을 활용하여 더욱 정교한 조정 전략을 구현할 수 있습니다.

## 참고 자료
- [Amazon EC2 Auto Scaling 사용 설명서](https://docs.aws.amazon.com/autoscaling/ec2/userguide/what-is-amazon-ec2-auto-scaling.html)
- [Auto Scaling 그룹 작동 방식](https://docs.aws.amazon.com/autoscaling/ec2/userguide/auto-scaling-groups.html)
- [조정 정책 유형](https://docs.aws.amazon.com/autoscaling/ec2/userguide/as-scale-based-on-demand.html)
- [Auto Scaling 모범 사례](https://docs.aws.amazon.com/autoscaling/ec2/userguide/auto-scaling-best-practices.html)