# 실습: 재해 복구 계획 수립 및 백업 구성

## 개요
이 실습에서는 AWS에서 재해 복구 계획을 수립하고 백업 솔루션을 구성하는 방법을 학습합니다. 간단한 웹 애플리케이션을 배포하고, AWS Backup을 사용하여 백업 전략을 구현하며, 다양한 재해 복구 시나리오를 시뮬레이션하고 대응하는 과정을 경험합니다.

## 학습 목표
- AWS Backup을 사용하여 중앙 집중식 백업 솔루션 구성 방법 습득
- 다양한 AWS 리소스에 대한 백업 및 복원 프로세스 이해
- 재해 복구 계획 수립 및 문서화 방법 학습
- 재해 시나리오 시뮬레이션 및 복구 절차 테스트 방법 이해
- 크로스 리전 백업 및 복구 구성 방법 습득

## 사전 준비 사항
- AWS 계정
- AWS CLI 설치 및 구성
- 기본 웹 서버 지식
- 기본 데이터베이스 지식
- 웹 브라우저

## 실습 시간
약 2시간

## 실습 단계

### 1. 간단한 웹 애플리케이션 배포

#### 1.1 VPC 및 서브넷 생성
1. AWS Management Console에 로그인합니다.
2. VPC 서비스로 이동합니다.
3. "VPC 생성" 버튼을 클릭합니다.
4. "VPC 등" 옵션을 선택하고 다음 정보를 입력합니다:
   - 이름 태그 자동 생성: `DR-Lab`
   - IPv4 CIDR 블록: `10.0.0.0/16`
   - 가용 영역 수: 2
   - 퍼블릭 서브넷 수: 2
   - 프라이빗 서브넷 수: 2
   - NAT 게이트웨이: 가용 영역당 1개
   - VPC 엔드포인트: 없음
5. "VPC 생성" 버튼을 클릭합니다.

#### 1.2 EC2 인스턴스 시작
1. EC2 서비스로 이동합니다.
2. "인스턴스 시작" 버튼을 클릭합니다.
3. 다음 정보를 입력합니다:
   - 이름: `web-server`
   - AMI: Amazon Linux 2023
   - 인스턴스 유형: t2.micro
   - 키 페어: 새 키 페어 생성 또는 기존 키 페어 선택
   - 네트워크 설정:
     - VPC: `DR-Lab-vpc`
     - 서브넷: 첫 번째 퍼블릭 서브넷
     - 퍼블릭 IP 자동 할당: 활성화
     - 보안 그룹: 새 보안 그룹 생성
       - 이름: `web-server-sg`
       - 인바운드 규칙: SSH(22), HTTP(80)
   - 고급 세부 정보:
     - 사용자 데이터:
     ```bash
     #!/bin/bash
     yum update -y
     yum install -y httpd
     systemctl start httpd
     systemctl enable httpd
     echo "<h1>DR Lab Web Server</h1><p>This is a test web server for the DR lab.</p>" > /var/www/html/index.html
     ```
4. "인스턴스 시작" 버튼을 클릭합니다.

#### 1.3 RDS 데이터베이스 생성
1. RDS 서비스로 이동합니다.
2. "데이터베이스 생성" 버튼을 클릭합니다.
3. "표준 생성" 옵션을 선택합니다.
4. 다음 정보를 입력합니다:
   - 엔진 유형: MySQL
   - 템플릿: 프리 티어
   - DB 인스턴스 식별자: `dr-lab-db`
   - 마스터 사용자 이름: `admin`
   - 마스터 암호: 안전한 암호 입력
   - DB 인스턴스 클래스: db.t2.micro
   - 스토리지 유형: 범용 SSD(gp2)
   - 할당된 스토리지: 20 GiB
   - 다중 AZ 배포: 대기 인스턴스 생성 안 함
   - VPC: `DR-Lab-vpc`
   - 서브넷 그룹: 새 서브넷 그룹 생성
     - 이름: `dr-lab-db-subnet-group`
     - 서브넷: 두 개의 프라이빗 서브넷 선택
   - 퍼블릭 액세스: 아니요
   - VPC 보안 그룹: 새로 생성
     - 이름: `dr-lab-db-sg`
   - 가용 영역: 첫 번째 AZ 선택
   - 데이터베이스 인증: 암호 인증
   - 초기 데이터베이스 이름: `drlab`
   - 자동 백업 활성화: 예
   - 백업 보존 기간: 7일
5. "데이터베이스 생성" 버튼을 클릭합니다.

#### 1.4 EC2 인스턴스와 RDS 연결
1. EC2 인스턴스에 SSH로 연결합니다:
   ```bash
   ssh -i your-key.pem ec2-user@your-instance-public-ip
   ```
2. MySQL 클라이언트를 설치합니다:
   ```bash
   sudo yum install -y mysql
   ```
3. RDS 데이터베이스에 연결합니다:
   ```bash
   mysql -h your-rds-endpoint -u admin -p drlab
   ```
4. 테스트 테이블을 생성하고 데이터를 삽입합니다:
   ```sql
   CREATE TABLE users (
     id INT AUTO_INCREMENT PRIMARY KEY,
     name VARCHAR(100),
     email VARCHAR(100),
     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
   );
   
   INSERT INTO users (name, email) VALUES
   ('User 1', 'user1@example.com'),
   ('User 2', 'user2@example.com'),
   ('User 3', 'user3@example.com');
   
   SELECT * FROM users;
   ```
5. MySQL 클라이언트를 종료합니다:
   ```sql
   EXIT;
   ```

### 2. AWS Backup 구성

#### 2.1 백업 볼트 생성
1. AWS Backup 서비스로 이동합니다.
2. 왼쪽 메뉴에서 "백업 볼트"를 클릭합니다.
3. "백업 볼트 생성" 버튼을 클릭합니다.
4. 다음 정보를 입력합니다:
   - 이름: `DR-Lab-Vault`
   - 암호화: 기본 암호화 사용
   - 태그: 필요에 따라 추가
5. "백업 볼트 생성" 버튼을 클릭합니다.

#### 2.2 백업 계획 생성
1. 왼쪽 메뉴에서 "백업 계획"을 클릭합니다.
2. "백업 계획 생성" 버튼을 클릭합니다.
3. "새 계획 생성" 옵션을 선택합니다.
4. 다음 정보를 입력합니다:
   - 이름: `DR-Lab-Plan`
   - 백업 규칙 구성:
     - 규칙 이름: `Daily-Backup`
     - 백업 볼트: `DR-Lab-Vault`
     - 백업 빈도: 매일
     - 백업 윈도우: 기본값 사용
     - 수명 주기: 35일 후 콜드 스토리지로 전환, 1년 후 만료
     - 크로스 리전 복사: 활성화
       - 대상 리전: 현재 리전과 다른 리전 선택
       - 대상 볼트: 새 볼트 생성
       - 복사본 수명 주기: 35일 후 콜드 스토리지로 전환, 1년 후 만료
5. "리소스 할당 생성" 버튼을 클릭합니다.
6. 다음 정보를 입력합니다:
   - 리소스 할당 이름: `DR-Lab-Resources`
   - IAM 역할: 기본 역할 사용
   - 리소스 선택 방법: 태그 포함
   - 태그 키: `Backup`
   - 태그 값: `true`
7. "백업 계획 생성" 버튼을 클릭합니다.

#### 2.3 리소스에 태그 추가
1. EC2 서비스로 이동하여 `web-server` 인스턴스를 선택합니다.
2. "태그" 탭을 클릭하고 "태그 관리" 버튼을 클릭합니다.
3. "새 태그 추가"를 클릭하고 다음 정보를 입력합니다:
   - 키: `Backup`
   - 값: `true`
4. "저장" 버튼을 클릭합니다.

5. RDS 서비스로 이동하여 `dr-lab-db` 데이터베이스를 선택합니다.
6. "태그" 탭을 클릭하고 "태그 추가" 버튼을 클릭합니다.
7. 다음 정보를 입력합니다:
   - 키: `Backup`
   - 값: `true`
8. "추가" 버튼을 클릭합니다.

#### 2.4 온디맨드 백업 생성
1. AWS Backup 서비스로 돌아갑니다.
2. 왼쪽 메뉴에서 "온디맨드 백업"을 클릭합니다.
3. "온디맨드 백업 생성" 버튼을 클릭합니다.
4. 다음 정보를 입력합니다:
   - 리소스 유형: EC2
   - 인스턴스 ID: `web-server` 선택
   - 백업 윈도우: 지금 시작
   - 보존 기간: 1개월
   - 백업 볼트: `DR-Lab-Vault`
   - IAM 역할: 기본 역할 사용
5. "온디맨드 백업 생성" 버튼을 클릭합니다.

6. 다시 "온디맨드 백업 생성" 버튼을 클릭합니다.
7. 다음 정보를 입력합니다:
   - 리소스 유형: RDS
   - 데이터베이스: `dr-lab-db` 선택
   - 백업 윈도우: 지금 시작
   - 보존 기간: 1개월
   - 백업 볼트: `DR-Lab-Vault`
   - IAM 역할: 기본 역할 사용
8. "온디맨드 백업 생성" 버튼을 클릭합니다.

### 3. 재해 시나리오 시뮬레이션 및 복구

#### 3.1 EC2 인스턴스 장애 시뮬레이션
1. EC2 서비스로 이동하여 `web-server` 인스턴스를 선택합니다.
2. "인스턴스 상태" > "인스턴스 종료"를 클릭합니다.
3. 확인 대화 상자에서 "종료"를 클릭합니다.
4. 인스턴스가 종료되었는지 확인합니다.

#### 3.2 EC2 인스턴스 복구
1. AWS Backup 서비스로 이동합니다.
2. 왼쪽 메뉴에서 "백업 볼트"를 클릭합니다.
3. `DR-Lab-Vault`를 선택합니다.
4. EC2 인스턴스의 복구 시점을 찾아 선택합니다.
5. "복원" 버튼을 클릭합니다.
6. 다음 정보를 입력합니다:
   - 인스턴스 유형: t2.micro
   - VPC: `DR-Lab-vpc`
   - 서브넷: 첫 번째 퍼블릭 서브넷
   - 보안 그룹: `web-server-sg`
   - 키 페어: 기존 키 페어 선택
7. "복원" 버튼을 클릭합니다.
8. EC2 콘솔에서 새 인스턴스가 생성되는 것을 확인합니다.
9. 인스턴스가 실행 중 상태가 되면 퍼블릭 IP 주소를 복사하여 웹 브라우저에서 접속합니다.
10. 웹 페이지가 정상적으로 표시되는지 확인합니다.

#### 3.3 데이터베이스 장애 시뮬레이션
1. RDS 서비스로 이동하여 `dr-lab-db` 데이터베이스를 선택합니다.
2. EC2 인스턴스에 SSH로 연결합니다:
   ```bash
   ssh -i your-key.pem ec2-user@your-new-instance-public-ip
   ```
3. MySQL 클라이언트를 설치합니다:
   ```bash
   sudo yum install -y mysql
   ```
4. RDS 데이터베이스에 연결합니다:
   ```bash
   mysql -h your-rds-endpoint -u admin -p drlab
   ```
5. 테이블을 삭제하여 장애를 시뮬레이션합니다:
   ```sql
   DROP TABLE users;
   EXIT;
   ```

#### 3.4 데이터베이스 복구
1. RDS 서비스로 이동하여 `dr-lab-db` 데이터베이스를 선택합니다.
2. "작업" > "특정 시점으로 복원"을 클릭합니다.
3. 다음 정보를 입력합니다:
   - 복원 시간: 테이블을 삭제하기 전 시간 선택
   - DB 인스턴스 식별자: `dr-lab-db-restored`
   - 나머지 설정은 원본 데이터베이스와 동일하게 유지
4. "DB 인스턴스 복원" 버튼을 클릭합니다.
5. 복원된 데이터베이스가 사용 가능 상태가 될 때까지 기다립니다.
6. EC2 인스턴스에 SSH로 연결합니다.
7. 복원된 데이터베이스에 연결합니다:
   ```bash
   mysql -h your-restored-rds-endpoint -u admin -p drlab
   ```
8. 테이블과 데이터가 복원되었는지 확인합니다:
   ```sql
   SHOW TABLES;
   SELECT * FROM users;
   EXIT;
   ```

### 4. 크로스 리전 재해 복구 테스트

#### 4.1 크로스 리전 복구 시점 확인
1. AWS Backup 서비스로 이동합니다.
2. 리전 선택기를 사용하여 백업 복사본이 저장된 대상 리전으로 전환합니다.
3. 왼쪽 메뉴에서 "백업 볼트"를 클릭합니다.
4. 크로스 리전 복사에서 생성된 볼트를 선택합니다.
5. 복구 시점이 성공적으로 복사되었는지 확인합니다.

#### 4.2 크로스 리전 EC2 복구
1. EC2 인스턴스의 복구 시점을 선택합니다.
2. "복원" 버튼을 클릭합니다.
3. 대상 리전에 적절한 VPC, 서브넷 및 보안 그룹을 선택합니다.
4. "복원" 버튼을 클릭합니다.
5. EC2 콘솔에서 대상 리전에 새 인스턴스가 생성되는 것을 확인합니다.

#### 4.3 크로스 리전 RDS 복구
1. RDS 데이터베이스의 복구 시점을 선택합니다.
2. "복원" 버튼을 클릭합니다.
3. 대상 리전에 적절한 설정을 선택합니다.
4. "복원" 버튼을 클릭합니다.
5. RDS 콘솔에서 대상 리전에 새 데이터베이스가 생성되는 것을 확인합니다.

### 5. 재해 복구 계획 문서화

#### 5.1 재해 복구 계획 템플릿 작성
1. 다음 구조로 재해 복구 계획 문서를 작성합니다:
   - 개요 및 목적
   - 중요 시스템 및 데이터 식별
   - 복구 목표 (RTO 및 RPO)
   - 재해 시나리오 및 대응 절차
   - 복구 팀 및 책임
   - 연락처 정보
   - 테스트 계획 및 일정

#### 5.2 EC2 인스턴스 복구 절차 문서화
1. EC2 인스턴스 장애 시 복구 절차를 단계별로 문서화합니다:
   - 장애 감지 방법
   - AWS Backup에서 복구 시점 선택
   - 복원 프로세스 단계
   - 복원 후 검증 단계

#### 5.3 RDS 데이터베이스 복구 절차 문서화
1. RDS 데이터베이스 장애 시 복구 절차를 단계별로 문서화합니다:
   - 장애 감지 방법
   - 특정 시점으로 복원 프로세스
   - 복원 후 검증 단계
   - 애플리케이션 재구성 단계

#### 5.4 크로스 리전 복구 절차 문서화
1. 리전 장애 시 크로스 리전 복구 절차를 단계별로 문서화합니다:
   - 장애 감지 방법
   - 대상 리전에서의 복구 프로세스
   - DNS 업데이트 단계
   - 복구 후 검증 단계

### 6. 정리

#### 6.1 리소스 삭제
1. 모든 복원된 EC2 인스턴스를 종료합니다.
2. 모든 복원된 RDS 데이터베이스를 삭제합니다.
3. 원본 RDS 데이터베이스 `dr-lab-db`를 삭제합니다.
4. AWS Backup 백업 계획을 삭제합니다.
5. AWS Backup 볼트를 삭제합니다 (복구 시점을 먼저 삭제해야 함).
6. VPC 및 관련 리소스를 삭제합니다.

## 도전 과제

### 도전 과제 1: 자동화된 복구 스크립트 작성
1. AWS CLI 또는 AWS SDK를 사용하여 EC2 인스턴스 복구를 자동화하는 스크립트를 작성합니다.
2. 스크립트에 다음 기능을 포함합니다:
   - 최신 복구 시점 식별
   - 인스턴스 복원
   - 복원 상태 확인
   - 복원 완료 알림

### 도전 과제 2: 다중 리전 아키텍처 설계
1. 두 개의 AWS 리전에 걸쳐 고가용성 아키텍처를 설계합니다.
2. 다음 구성 요소를 포함합니다:
   - Route 53을 사용한 DNS 장애 조치
   - 리전 간 데이터 복제
   - 자동화된 장애 감지 및 복구

### 도전 과제 3: 비용 최적화된 백업 전략 개발
1. 다양한 중요도 수준의 데이터에 대한 계층형 백업 전략을 개발합니다.
2. 다음 요소를 고려합니다:
   - 데이터 중요도에 따른 백업 빈도
   - 스토리지 계층화 (표준, 콜드, 아카이브)
   - 보존 기간 최적화
   - 비용 분석 및 예측

## 결론
이 실습을 통해 AWS에서 재해 복구 계획을 수립하고 백업 솔루션을 구성하는 방법을 학습했습니다. AWS Backup을 사용하여 EC2 인스턴스와 RDS 데이터베이스의 백업을 중앙에서 관리하고, 다양한 재해 시나리오를 시뮬레이션하여 복구 절차를 테스트했습니다. 또한 크로스 리전 백업 및 복구를 구성하여 리전 수준의 장애에도 대응할 수 있는 방법을 경험했습니다. 이러한 기술은 AWS에서 안정적이고 복원력 있는 시스템을 구축하는 데 필수적입니다.

## 참고 자료
- [AWS Backup 사용 설명서](https://docs.aws.amazon.com/aws-backup/latest/devguide/whatisbackup.html)
- [AWS 재해 복구 백서](https://docs.aws.amazon.com/whitepapers/latest/disaster-recovery-workloads-on-aws/disaster-recovery-workloads-on-aws.html)
- [Amazon EC2 사용 설명서](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/concepts.html)
- [Amazon RDS 사용 설명서](https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Welcome.html)
- [AWS Well-Architected Framework - 안정성 기둥](https://docs.aws.amazon.com/wellarchitected/latest/reliability-pillar/welcome.html)