# 실습: EC2 인스턴스 배포 및 관리

## 개요
이 실습에서는 Amazon EC2 인스턴스를 배포하고 관리하는 방법을 학습합니다. 기본적인 EC2 인스턴스 시작부터 보안 설정, 연결, 모니터링까지 EC2의 핵심 기능을 직접 경험해 볼 것입니다.

## 학습 목표
- EC2 인스턴스 시작 및 구성 방법 습득
- 보안 그룹 설정 및 관리 방법 이해
- EC2 인스턴스에 연결하는 다양한 방법 학습
- EC2 인스턴스 모니터링 및 관리 방법 습득
- 고가용성을 위한 다중 AZ 배포 구성

## 사전 준비 사항
- AWS 계정
- 기본 네트워크 지식
- SSH 클라이언트(Windows의 경우 PuTTY 또는 Windows Subsystem for Linux)
- 웹 브라우저

## 실습 시간
약 2시간

## 실습 단계

### 1. EC2 인스턴스 시작하기

#### 1.1 AWS 관리 콘솔 접속
1. 웹 브라우저를 열고 AWS 관리 콘솔(https://console.aws.amazon.com/)에 로그인합니다.
2. 상단 검색창에 "EC2"를 입력하거나 서비스 메뉴에서 "EC2"를 선택합니다.
3. EC2 대시보드가 표시됩니다.

#### 1.2 인스턴스 시작
1. EC2 대시보드에서 "인스턴스 시작" 버튼을 클릭합니다.
2. 다음 설정으로 인스턴스를 구성합니다:
   - **이름**: `WebServer-Lab`
   - **애플리케이션 및 OS 이미지**: Amazon Linux 2023 AMI 선택
   - **인스턴스 유형**: t2.micro (프리 티어 사용 가능)
   - **키 페어**: 
     - "새 키 페어 생성" 클릭
     - 키 페어 이름: `ec2-lab-key`
     - 키 페어 유형: RSA
     - 프라이빗 키 파일 형식: .pem (macOS/Linux용) 또는 .ppk (Windows용)
     - "키 페어 생성" 클릭하고 키 파일을 안전한 위치에 저장
   - **네트워크 설정**:
     - "편집" 버튼 클릭
     - VPC: 기본 VPC 선택
     - 서브넷: 가용 영역 a의 서브넷 선택 (예: us-east-1a)
     - 퍼블릭 IP 자동 할당: 활성화
     - 보안 그룹: 새 보안 그룹 생성
     - 보안 그룹 이름: `web-server-sg`
     - 설명: Web server security group
     - 인바운드 규칙:
       - SSH(22번 포트): 내 IP
       - HTTP(80번 포트): 모든 곳(0.0.0.0/0)
   - **스토리지 구성**:
     - 볼륨 유형: gp3
     - 크기: 8 GiB
   - **고급 세부 정보**:
     - 사용자 데이터:
     ```bash
     #!/bin/bash
     yum update -y
     yum install -y httpd
     systemctl start httpd
     systemctl enable httpd
     echo "<h1>Hello from $(hostname -f)</h1>" > /var/www/html/index.html
     ```

3. 설정을 검토하고 "인스턴스 시작" 버튼을 클릭합니다.
4. "인스턴스 보기" 버튼을 클릭하여 시작 중인 인스턴스를 확인합니다.

### 2. EC2 인스턴스 연결 및 관리

#### 2.1 인스턴스 상태 확인
1. 인스턴스 목록에서 방금 생성한 `WebServer-Lab` 인스턴스를 찾습니다.
2. 상태 확인 열을 확인하여 인스턴스가 "2/2 확인 통과"를 표시할 때까지 기다립니다.
3. 인스턴스 상태가 "실행 중"으로 변경되면 다음 단계로 진행합니다.

#### 2.2 웹 서버 접속 확인
1. 인스턴스 목록에서 `WebServer-Lab` 인스턴스를 선택합니다.
2. 하단 세부 정보 패널에서 "퍼블릭 IPv4 주소"를 찾습니다.
3. 이 IP 주소를 복사하여 새 브라우저 탭에 붙여넣고 접속합니다.
4. "Hello from ip-xxx-xxx-xxx-xxx.region.compute.internal" 메시지가 표시되면 웹 서버가 정상적으로 작동하는 것입니다.

#### 2.3 SSH를 통한 인스턴스 연결

**Linux/macOS 사용자:**
1. 터미널을 엽니다.
2. 키 파일의 권한을 변경합니다:
   ```bash
   chmod 400 ~/Downloads/ec2-lab-key.pem
   ```
3. SSH 명령으로 인스턴스에 연결합니다:
   ```bash
   ssh -i ~/Downloads/ec2-lab-key.pem ec2-user@[퍼블릭_IP_주소]
   ```

**Windows 사용자(PuTTY 사용):**
1. PuTTY Key Generator(PuTTYgen)를 실행합니다.
2. "Load" 버튼을 클릭하고 다운로드한 .pem 파일을 선택합니다.
3. "Save private key" 버튼을 클릭하여 .ppk 파일로 저장합니다.
4. PuTTY를 실행합니다.
5. "Host Name" 필드에 `ec2-user@[퍼블릭_IP_주소]`를 입력합니다.
6. 왼쪽 메뉴에서 Connection > SSH > Auth를 선택합니다.
7. "Browse" 버튼을 클릭하고 저장한 .ppk 파일을 선택합니다.
8. "Open" 버튼을 클릭하여 연결합니다.

#### 2.4 인스턴스 기본 관리 명령어 실습
인스턴스에 연결한 후 다음 명령어를 실행해 봅니다:

1. 시스템 정보 확인:
   ```bash
   uname -a
   cat /etc/os-release
   ```

2. 시스템 리소스 확인:
   ```bash
   top
   ```
   (종료하려면 'q' 키 누름)

3. 디스크 사용량 확인:
   ```bash
   df -h
   ```

4. 웹 서버 상태 확인:
   ```bash
   sudo systemctl status httpd
   ```

5. 웹 페이지 수정:
   ```bash
   sudo bash -c 'echo "<h1>Welcome to my EC2 instance!</h1><p>This page was modified manually.</p>" > /var/www/html/index.html'
   ```

6. 브라우저에서 페이지를 새로고침하여 변경 사항 확인

### 3. 고가용성을 위한 다중 AZ 배포

#### 3.1 두 번째 가용 영역에 인스턴스 배포
1. EC2 대시보드로 돌아가서 "인스턴스 시작" 버튼을 클릭합니다.
2. 첫 번째 인스턴스와 동일한 설정을 사용하되 다음 사항만 변경합니다:
   - **이름**: `WebServer-Lab-2`
   - **네트워크 설정**:
     - 서브넷: 가용 영역 b의 서브넷 선택 (예: us-east-1b)
     - 보안 그룹: 기존 보안 그룹 선택 (`web-server-sg`)

3. "인스턴스 시작" 버튼을 클릭합니다.
4. 두 번째 인스턴스가 실행 중 상태가 되고 상태 확인을 통과할 때까지 기다립니다.

#### 3.2 두 번째 인스턴스 확인
1. 두 번째 인스턴스의 퍼블릭 IP 주소를 복사하여 새 브라우저 탭에서 접속합니다.
2. 호스트 이름이 다른 것을 확인합니다.

### 4. EC2 인스턴스 모니터링

#### 4.1 CloudWatch 기본 모니터링 확인
1. EC2 대시보드에서 첫 번째 인스턴스를 선택합니다.
2. "모니터링" 탭을 클릭합니다.
3. CPU 사용률, 네트워크 트래픽 등의 기본 지표를 확인합니다.

#### 4.2 상세 모니터링 활성화
1. "작업" 버튼을 클릭하고 "모니터링 및 문제 해결" > "세부 모니터링 관리"를 선택합니다.
2. "세부 모니터링 활성화" 옵션을 선택하고 "저장" 버튼을 클릭합니다.
3. 모니터링 탭을 새로고침하여 더 자세한 지표가 표시되는지 확인합니다.

#### 4.3 부하 생성 및 모니터링
1. SSH를 통해 첫 번째 인스턴스에 연결합니다.
2. 다음 명령어로 CPU 부하를 생성합니다:
   ```bash
   stress --cpu 1 --timeout 300
   ```
   (stress 명령어가 없는 경우 `sudo yum install -y stress` 명령으로 설치)

3. EC2 콘솔의 모니터링 탭에서 CPU 사용률이 증가하는 것을 확인합니다.

### 5. 인스턴스 중지 및 시작

#### 5.1 인스턴스 중지
1. EC2 대시보드에서 첫 번째 인스턴스를 선택합니다.
2. "인스턴스 상태" > "인스턴스 중지"를 클릭합니다.
3. 확인 대화 상자에서 "중지"를 클릭합니다.
4. 인스턴스 상태가 "중지됨"으로 변경될 때까지 기다립니다.
5. 브라우저에서 해당 인스턴스의 IP 주소로 접속을 시도하여 웹 서버에 접속할 수 없는 것을 확인합니다.

#### 5.2 인스턴스 시작
1. 중지된 인스턴스를 선택합니다.
2. "인스턴스 상태" > "인스턴스 시작"을 클릭합니다.
3. 인스턴스 상태가 "실행 중"으로 변경될 때까지 기다립니다.
4. 인스턴스의 새 퍼블릭 IP 주소를 확인합니다(중지 후 시작하면 퍼블릭 IP가 변경됨).
5. 새 IP 주소로 웹 서버에 접속하여 정상 작동하는지 확인합니다.

### 6. 인스턴스 이미지 생성 및 복원

#### 6.1 AMI 생성
1. 첫 번째 인스턴스를 선택합니다.
2. "작업" > "이미지 및 템플릿" > "이미지 생성"을 클릭합니다.
3. 다음 정보를 입력합니다:
   - 이미지 이름: `WebServer-AMI`
   - 이미지 설명: `Web server with Apache installed`
4. "이미지 생성" 버튼을 클릭합니다.
5. 왼쪽 메뉴에서 "AMI"를 클릭하여 생성 중인 AMI를 확인합니다.
6. AMI 상태가 "사용 가능"으로 변경될 때까지 기다립니다.

#### 6.2 AMI에서 인스턴스 시작
1. 생성한 AMI를 선택합니다.
2. "AMI에서 인스턴스 시작" 버튼을 클릭합니다.
3. 다음 설정으로 인스턴스를 구성합니다:
   - 이름: `WebServer-From-AMI`
   - 인스턴스 유형: t2.micro
   - 키 페어: 기존 `ec2-lab-key` 선택
   - 네트워크 설정: 기존 보안 그룹 `web-server-sg` 선택
4. "인스턴스 시작" 버튼을 클릭합니다.
5. 인스턴스가 실행 중 상태가 되면 퍼블릭 IP 주소로 접속하여 웹 서버가 이미 구성되어 있는지 확인합니다.

### 7. 정리

#### 7.1 인스턴스 종료
1. 생성한 모든 인스턴스를 선택합니다.
2. "인스턴스 상태" > "인스턴스 종료"를 클릭합니다.
3. 확인 대화 상자에서 "종료"를 클릭합니다.
4. 인스턴스 상태가 "종료됨"으로 변경될 때까지 기다립니다.

#### 7.2 AMI 등록 취소
1. 왼쪽 메뉴에서 "AMI"를 클릭합니다.
2. 생성한 AMI를 선택합니다.
3. "작업" > "등록 취소"를 클릭합니다.
4. 확인 대화 상자에서 "등록 취소"를 클릭합니다.

#### 7.3 스냅샷 삭제
1. 왼쪽 메뉴에서 "스냅샷"을 클릭합니다.
2. AMI와 관련된 스냅샷을 선택합니다.
3. "작업" > "스냅샷 삭제"를 클릭합니다.
4. 확인 대화 상자에서 "삭제"를 클릭합니다.

## 도전 과제

### 도전 과제 1: 사용자 데이터 스크립트 수정
1. 새 EC2 인스턴스를 시작하되, 사용자 데이터 스크립트를 수정하여 다음을 수행하도록 합니다:
   - Apache 웹 서버 설치
   - 간단한 HTML 페이지 생성 (자신의 이름과 간단한 소개 포함)
   - 현재 날짜와 시간을 표시하는 PHP 페이지 생성

### 도전 과제 2: 인스턴스 메타데이터 활용
1. EC2 인스턴스에 연결합니다.
2. 인스턴스 메타데이터 서비스를 사용하여 다음 정보를 가져옵니다:
   - 인스턴스 ID
   - 인스턴스 유형
   - 가용 영역
   - 퍼블릭 IP 주소
3. 이 정보를 웹 페이지에 표시하도록 index.html 파일을 수정합니다.

### 도전 과제 3: CloudWatch 경보 설정
1. CPU 사용률이 80%를 초과할 때 이메일 알림을 보내는 CloudWatch 경보를 설정합니다.
2. stress 명령어를 사용하여 CPU 부하를 생성하고 경보가 트리거되는지 확인합니다.

## 결론
이 실습을 통해 Amazon EC2 인스턴스를 배포하고 관리하는 기본적인 방법을 학습했습니다. EC2 인스턴스 시작, 보안 그룹 구성, SSH 연결, 웹 서버 설정, 모니터링, AMI 생성 등의 핵심 기능을 실습했습니다. 또한 고가용성을 위한 다중 AZ 배포의 기초를 경험했습니다. 이러한 기술은 AWS에서 안정적이고 확장 가능한 애플리케이션을 구축하는 데 필수적입니다.

## 참고 자료
- [Amazon EC2 사용 설명서](https://docs.aws.amazon.com/ec2/index.html)
- [Amazon EC2 인스턴스 유형](https://aws.amazon.com/ec2/instance-types/)
- [Amazon EC2 보안 그룹](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-security-groups.html)
- [Amazon EC2 사용자 데이터 및 셸 스크립트](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html)